(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{389:function(_,a,t){"use strict";t.r(a);var v=t(7),e=Object(v.a)({},(function(){var _=this,a=_._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[a("p",[_._v("ğŸ–¥ï¸ä¸ªäººå°ç«™ ï¼š"),a("a",{attrs:{href:"https://manamn.space/",target:"_blank",rel:"noopener noreferrer"}},[_._v("ä¸ªäººåšå®¢"),a("OutboundLink")],1),_._v("ï¼Œæ¬¢è¿å¤§å®¶è®¿é—®")]),_._v(" "),a("p",[_._v("é…å¥—è§†é¢‘å‚è€ƒï¼š"),a("a",{attrs:{href:"https://www.bilibili.com/video/BV1iq4y1u7vj?p=1&vd_source=cea816a08805c218ac4390ae9b61ae31",target:"_blank",rel:"noopener noreferrer"}},[_._v("MySQLæ•°æ®åº“å¤©èŠ±æ¿--åº·å¸ˆå‚…"),a("OutboundLink")],1)]),_._v(" "),a("h2",{attrs:{id:"_1-æ¦‚è¿°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¦‚è¿°"}},[_._v("#")]),_._v(" 1. æ¦‚è¿°")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711165954976.png",alt:"image-20220711165954976"}}),_._v(" "),a("p",[_._v("åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„ èµ„æºã€‚ä¸ºä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦å¯¹ "),a("code",[_._v("å¹¶å‘æ“ä½œè¿›è¡Œæ§åˆ¶")]),_._v(" ï¼Œå› æ­¤äº§ç”Ÿäº† "),a("code",[_._v("é”")]),_._v(" ã€‚åŒæ—¶ "),a("code",[_._v("é”æœºåˆ¶")]),_._v(" ä¹Ÿä¸ºå®ç°MySQL çš„å„ä¸ªéš”ç¦»çº§åˆ«æä¾›äº†ä¿è¯ã€‚ "),a("code",[_._v("é”å†²çª")]),_._v(" ä¹Ÿæ˜¯å½±å“æ•°æ®åº“ "),a("code",[_._v("å¹¶å‘è®¿é—®æ€§èƒ½")]),_._v(" çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æ‰€ä»¥é”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚")]),_._v(" "),a("h2",{attrs:{id:"_2-mysqlå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-mysqlå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•"}},[_._v("#")]),_._v(" 2. MySQLå¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•")]),_._v(" "),a("p",[_._v("å¹¶å‘äº‹åŠ¡è®¿é—®ç›¸åŒè®°å½•çš„æƒ…å†µå¤§è‡´å¯ä»¥åˆ’åˆ†ä¸º3ç§ï¼š")]),_._v(" "),a("h3",{attrs:{id:"_2-1-è¯»-è¯»æƒ…å†µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-è¯»-è¯»æƒ…å†µ"}},[_._v("#")]),_._v(" 2.1 è¯»-è¯»æƒ…å†µ")]),_._v(" "),a("p",[a("code",[_._v("è¯»-è¯»")]),_._v("æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§"),a("code",[_._v("è¯»å–ç›¸åŒçš„è®°å½•")]),_._v("ã€‚è¯»å–æ“ä½œæœ¬èº«ä¸ä¼šå¯¹è®°å½•æœ‰ä»»ä½•å½±å“ï¼Œå¹¶ä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚")]),_._v(" "),a("h3",{attrs:{id:"_2-2-å†™-å†™æƒ…å†µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-å†™-å†™æƒ…å†µ"}},[_._v("#")]),_._v(" 2.2 å†™-å†™æƒ…å†µ")]),_._v(" "),a("p",[a("code",[_._v("å†™-å†™")]),_._v(" æƒ…å†µï¼Œå³å¹¶å‘äº‹åŠ¡ç›¸ç»§å¯¹ç›¸åŒçš„è®°å½•åšå‡ºæ”¹åŠ¨ã€‚")]),_._v(" "),a("p",[_._v("åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿ "),a("code",[_._v("è„å†™")]),_._v(" çš„é—®é¢˜ï¼Œä»»ä½•ä¸€ç§éš”ç¦»çº§åˆ«éƒ½ä¸å…è®¸è¿™ç§é—®é¢˜çš„å‘ç”Ÿã€‚æ‰€ä»¥åœ¨å¤šä¸ªæœªæäº¤äº‹åŠ¡ç›¸ç»§å¯¹ä¸€æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œéœ€è¦è®©å®ƒä»¬ "),a("code",[_._v("æ’é˜Ÿæ‰§è¡Œ")]),_._v(" ï¼Œè¿™ä¸ªæ’é˜Ÿçš„è¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡ "),a("code",[_._v("é”")]),_._v(" æ¥å®ç°çš„ã€‚è¿™ä¸ªæ‰€è°“çš„é”å…¶å®æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„ç»“æ„ ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰æœ¬æ¥æ˜¯æ²¡æœ‰é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€å¼€å§‹æ˜¯æ²¡æœ‰ é”ç»“æ„ å’Œè®°å½•è¿› è¡Œå…³è”çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711181120639.png",alt:"image-20220711181120639"}})]),_._v(" "),a("p",[_._v("å½“ä¸€ä¸ªäº‹åŠ¡æƒ³å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šçœ‹çœ‹å†…å­˜ä¸­æœ‰æ²¡æœ‰ä¸è¿™æ¡è®°å½•å…³è”çš„ "),a("code",[_._v("é”ç»“æ„")]),_._v(" ï¼Œå½“æ²¡æœ‰çš„æ—¶å€™ å°±ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª "),a("code",[_._v("é”ç»“æ„")]),_._v(" ä¸ä¹‹å…³è”ã€‚æ¯”å¦‚ï¼Œäº‹åŠ¡"),a("code",[_._v("T1")]),_._v(" è¦å¯¹è¿™æ¡è®°å½•åšæ”¹åŠ¨ï¼Œå°±éœ€è¦ç”Ÿæˆä¸€ä¸ª "),a("code",[_._v("é”ç»“æ„")]),_._v(" ä¸ä¹‹å…³è”ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711192633239.png",alt:"image-20220711192633239"}})]),_._v(" "),a("p",[_._v("åœ¨"),a("code",[_._v("é”ç»“æ„")]),_._v("é‡Œæœ‰å¾ˆå¤šä¿¡æ¯ï¼Œä¸ºäº†ç®€åŒ–ç†è§£ï¼ŒåªæŠŠä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„å±æ€§æ‹¿äº†å‡ºæ¥ï¼š")]),_._v(" "),a("ul",[a("li",[a("code",[_._v("trxä¿¡æ¯")]),_._v("ï¼šä»£è¡¨è¿™ä¸ªé”ç»“æ„æ˜¯å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚")]),_._v(" "),a("li",[a("code",[_._v("is_waiting")]),_._v("ï¼šä»£è¡¨å½“å‰äº‹åŠ¡æ˜¯å¦åœ¨ç­‰å¾…ã€‚")])]),_._v(" "),a("p",[_._v("åœ¨äº‹åŠ¡"),a("code",[_._v("T1")]),_._v("æ”¹åŠ¨äº†è¿™æ¡è®°å½•åï¼Œå°±ç”Ÿæˆäº†ä¸€ä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("ä¸è¯¥è®°å½•å…³è”ï¼Œå› ä¸ºä¹‹å‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡ä¸ºè¿™æ¡è®°å½•åŠ é”ï¼Œæ‰€ä»¥"),a("code",[_._v("is_waiting")]),_._v("å±æ€§å°±æ˜¯"),a("code",[_._v("false")]),_._v("ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°å€¼ä¸º"),a("code",[_._v("è·å–é”æˆåŠŸ")]),_._v("ï¼Œæˆ–è€…"),a("code",[_._v("åŠ é”æˆåŠŸ")]),_._v("ï¼Œç„¶åå°±å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œäº†ã€‚")]),_._v(" "),a("p",[_._v("åœ¨äº‹åŠ¡"),a("code",[_._v("T1")]),_._v("æäº¤ä¹‹å‰ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡"),a("code",[_._v("T2")]),_._v("ä¹Ÿæƒ³å¯¹è¯¥è®°å½•åšæ”¹åŠ¨ï¼Œé‚£ä¹ˆå…ˆçœ‹çœ‹æœ‰æ²¡æœ‰"),a("code",[_._v("é”ç»“æ„")]),_._v("ä¸è¿™æ¡è®°å½•å…³è”ï¼Œå‘ç°æœ‰ä¸€ä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("ä¸ä¹‹å…³è”åï¼Œç„¶åä¹Ÿç”Ÿæˆäº†ä¸€ä¸ªé”ç»“æ„ä¸è¿™æ¡è®°å½•å…³è”ï¼Œä¸è¿‡é”ç»“æ„çš„"),a("code",[_._v("is_waiting")]),_._v("å±æ€§å€¼ä¸º"),a("code",[_._v("true")]),_._v("ï¼Œè¡¨ç¤ºå½“å‰äº‹åŠ¡éœ€è¦ç­‰å¾…ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåœºæ™¯å°±ç§°ä¹‹ä¸º"),a("code",[_._v("è·å–é”å¤±è´¥")]),_._v("ï¼Œæˆ–è€…"),a("code",[_._v("åŠ é”å¤±è´¥")]),_._v("ï¼Œå›¾ç¤ºï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711193732567.png",alt:"image-20220711193732567"}})]),_._v(" "),a("p",[_._v("åœ¨äº‹åŠ¡T1æäº¤ä¹‹åï¼Œå°±ä¼šæŠŠè¯¥äº‹åŠ¡ç”Ÿæˆçš„"),a("code",[_._v("é”ç»“æ„é‡Šæ”¾")]),_._v("æ‰ï¼Œç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰åˆ«çš„äº‹åŠ¡åœ¨ç­‰å¾…è·å–é”ï¼Œå‘ç°äº†äº‹åŠ¡T2è¿˜åœ¨ç­‰å¾…è·å–é”ï¼Œæ‰€ä»¥æŠŠäº‹åŠ¡T2å¯¹åº”çš„é”ç»“æ„çš„"),a("code",[_._v("is_waiting")]),_._v("å±æ€§è®¾ç½®ä¸º"),a("code",[_._v("false")]),_._v("ï¼Œç„¶åæŠŠè¯¥äº‹åŠ¡å¯¹åº”çš„çº¿ç¨‹å”¤é†’ï¼Œè®©å®ƒç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶äº‹åŠ¡T2å°±ç®—è·å–åˆ°é”äº†ã€‚æ•ˆæœå°±æ˜¯è¿™æ ·ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711194904328.png",alt:"image-20220711194904328"}})]),_._v(" "),a("p",[_._v("å°ç»“å‡ ç§è¯´æ³•ï¼š")]),_._v(" "),a("ul",[a("li",[a("p",[_._v("ä¸åŠ é”")]),_._v(" "),a("p",[_._v("æ„æ€å°±æ˜¯ä¸éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆå¯¹åº”çš„ "),a("code",[_._v("é”ç»“æ„")]),_._v(" ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œæ“ä½œã€‚")])]),_._v(" "),a("li",[a("p",[_._v("è·å–é”æˆåŠŸï¼Œæˆ–è€…åŠ é”æˆåŠŸ")]),_._v(" "),a("p",[_._v("æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„ "),a("code",[_._v("é”ç»“æ„")]),_._v(" ï¼Œè€Œä¸”é”ç»“æ„çš„ "),a("code",[_._v("is_waiting")]),_._v(" å±æ€§ä¸º "),a("code",[_._v("false")]),_._v(" ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚")])]),_._v(" "),a("li",[a("p",[_._v("è·å–é”å¤±è´¥ï¼Œæˆ–è€…åŠ é”å¤±è´¥ï¼Œæˆ–è€…æ²¡æœ‰è·å–åˆ°é”")]),_._v(" "),a("p",[_._v("æ„æ€å°±æ˜¯åœ¨å†…å­˜ä¸­ç”Ÿæˆäº†å¯¹åº”çš„ "),a("code",[_._v("é”ç»“æ„")]),_._v(" ï¼Œä¸è¿‡é”ç»“æ„çš„ "),a("code",[_._v("is_waiting")]),_._v(" å±æ€§ä¸º "),a("code",[_._v("true")]),_._v(" ï¼Œä¹Ÿå°±æ˜¯äº‹åŠ¡ éœ€è¦ç­‰å¾…ï¼Œä¸å¯ä»¥ç»§ç»­æ‰§è¡Œæ“ä½œã€‚")])])]),_._v(" "),a("h3",{attrs:{id:"_2-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ"}},[_._v("#")]),_._v(" 2.3 è¯»-å†™æˆ–å†™-è¯»æƒ…å†µ")]),_._v(" "),a("p",[a("code",[_._v("è¯»-å†™")]),_._v(" æˆ– "),a("code",[_._v("å†™-è¯»")]),_._v("ï¼Œå³ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªè¿›è¡Œæ”¹åŠ¨æ“ä½œã€‚è¿™ç§æƒ…å†µä¸‹å¯èƒ½å‘ç”Ÿ "),a("code",[_._v("è„è¯» ã€ ä¸å¯é‡ å¤è¯» ã€ å¹»è¯»")]),_._v(" çš„é—®é¢˜ã€‚")]),_._v(" "),a("p",[_._v("å„ä¸ªæ•°æ®åº“å‚å•†å¯¹ "),a("code",[_._v("SQLæ ‡å‡†")]),_._v(" çš„æ”¯æŒéƒ½å¯èƒ½ä¸ä¸€æ ·ã€‚æ¯”å¦‚MySQLåœ¨ "),a("code",[_._v("REPEATABLE READ")]),_._v(" éš”ç¦»çº§åˆ«ä¸Šå°±å·²ç»è§£å†³äº† "),a("code",[_._v("å¹»è¯»")]),_._v(" é—®é¢˜ã€‚")]),_._v(" "),a("h3",{attrs:{id:"_2-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"}},[_._v("#")]),_._v(" 2.4 å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ")]),_._v(" "),a("p",[_._v("æ€ä¹ˆè§£å†³ "),a("code",[_._v("è„è¯» ã€ ä¸å¯é‡å¤è¯» ã€ å¹»è¯»")]),_._v(" è¿™äº›é—®é¢˜å‘¢ï¼Ÿå…¶å®æœ‰ä¸¤ç§å¯é€‰çš„è§£å†³æ–¹æ¡ˆï¼š")]),_._v(" "),a("ul",[a("li",[_._v("æ–¹æ¡ˆä¸€ï¼šè¯»æ“ä½œåˆ©ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ "),a("code",[_._v("MVCC")]),_._v(" ï¼Œä¸‹ç« è®²è§£ï¼‰ï¼Œå†™æ“ä½œè¿›è¡Œ "),a("code",[_._v("åŠ é”")]),_._v(" ã€‚")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711202206405.png",alt:"image-20220711202206405"}}),_._v(" "),a("blockquote",[a("p",[_._v("æ™®é€šçš„SELECTè¯­å¥åœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ä¼šä½¿ç”¨åˆ°MVCCè¯»å–è®°å½•ã€‚")]),_._v(" "),a("ul",[a("li",[_._v("åœ¨ "),a("code",[_._v("READ COMMITTED")]),_._v(" éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡æ‰§è¡ŒSELECTæ“ä½œæ—¶éƒ½ä¼šç”Ÿæˆä¸€ ä¸ªReadViewï¼ŒReadViewçš„å­˜åœ¨æœ¬èº«å°±ä¿è¯äº†"),a("code",[_._v("äº‹åŠ¡ä¸å¯ä»¥è¯»å–åˆ°æœªæäº¤çš„äº‹åŠ¡æ‰€åšçš„æ›´æ”¹")]),_._v(" ï¼Œä¹Ÿå°±æ˜¯é¿å…äº†è„è¯»ç°è±¡ï¼›")]),_._v(" "),a("li",[_._v("åœ¨ "),a("code",[_._v("REPEATABLE READ")]),_._v(" éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­åªæœ‰ "),a("code",[_._v("ç¬¬ä¸€æ¬¡æ‰§è¡ŒSELECTæ“ä½œ")]),_._v(" æ‰ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¹‹åçš„SELECTæ“ä½œéƒ½ "),a("code",[_._v("å¤ç”¨")]),_._v(" è¿™ä¸ªReadViewï¼Œè¿™æ ·ä¹Ÿå°±é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„é—®é¢˜ã€‚")])])]),_._v(" "),a("ul",[a("li",[_._v("æ–¹æ¡ˆäºŒï¼šè¯»ã€å†™æ“ä½œéƒ½é‡‡ç”¨ "),a("code",[_._v("åŠ é”")]),_._v(" çš„æ–¹å¼ã€‚")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711203250284.png",alt:"image-20220711203250284"}}),_._v(" "),a("ul",[a("li",[a("p",[_._v("å°ç»“å¯¹æ¯”å‘ç°ï¼š")]),_._v(" "),a("ul",[a("li",[_._v("é‡‡ç”¨ "),a("code",[_._v("MVCC")]),_._v(" æ–¹å¼çš„è¯ï¼Œ è¯»-å†™ æ“ä½œå½¼æ­¤å¹¶ä¸å†²çªï¼Œ æ€§èƒ½æ›´é«˜ ã€‚")]),_._v(" "),a("li",[_._v("é‡‡ç”¨ "),a("code",[_._v("åŠ é”")]),_._v(" æ–¹å¼çš„è¯ï¼Œ è¯»-å†™ æ“ä½œå½¼æ­¤éœ€è¦ "),a("code",[_._v("æ’é˜Ÿæ‰§è¡Œ")]),_._v(" ï¼Œå½±å“æ€§èƒ½ã€‚")])]),_._v(" "),a("p",[_._v("ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å½“ç„¶æ„¿æ„é‡‡ç”¨ "),a("code",[_._v("MVCC")]),_._v(" æ¥è§£å†³ "),a("code",[_._v("è¯»-å†™")]),_._v(" æ“ä½œå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ï¼Œä½†æ˜¯ä¸šåŠ¡åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¦æ±‚å¿…é¡»é‡‡ç”¨ "),a("code",[_._v("åŠ é”")]),_._v("çš„æ–¹å¼æ‰§è¡Œã€‚ä¸‹é¢å°±è®²è§£ä¸‹MySQLä¸­ä¸åŒç±»åˆ«çš„é”ã€‚")])])]),_._v(" "),a("h2",{attrs:{id:"_3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-é”çš„ä¸åŒè§’åº¦åˆ†ç±»"}},[_._v("#")]),_._v(" 3. é”çš„ä¸åŒè§’åº¦åˆ†ç±»")]),_._v(" "),a("p",[_._v("é”çš„åˆ†ç±»å›¾ï¼Œå¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711203519162.png",alt:"image-20220711203519162"}})]),_._v(" "),a("h3",{attrs:{id:"_3-1-ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†-è¯»é”ã€å†™é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†-è¯»é”ã€å†™é”"}},[_._v("#")]),_._v(" 3.1 ä»æ•°æ®æ“ä½œçš„ç±»å‹åˆ’åˆ†ï¼šè¯»é”ã€å†™é”")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711203723941.png",alt:"image-20220711203723941"}}),_._v(" "),a("ul",[a("li",[a("code",[_._v("è¯»é”")]),_._v(" ï¼šä¹Ÿç§°ä¸º "),a("code",[_._v("å…±äº«é”")]),_._v(" ã€è‹±æ–‡ç”¨ S è¡¨ç¤ºã€‚é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡çš„è¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼Œç›¸äº’ä¸é˜»å¡çš„ã€‚")]),_._v(" "),a("li",[a("code",[_._v("å†™é”")]),_._v(" ï¼šä¹Ÿç§°ä¸º "),a("code",[_._v("æ’ä»–é”")]),_._v(" ã€è‹±æ–‡ç”¨ X è¡¨ç¤ºã€‚å½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚è¿™æ · å°±èƒ½ç¡®ä¿åœ¨ç»™å®šçš„æ—¶é—´é‡Œï¼Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½æ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–ç”¨æˆ·è¯»å–æ­£åœ¨å†™å…¥çš„åŒä¸€èµ„æºã€‚")])]),_._v(" "),a("p",[a("strong",[_._v("éœ€è¦æ³¨æ„çš„æ˜¯å¯¹äº InnoDB å¼•æ“æ¥è¯´ï¼Œè¯»é”å’Œå†™é”å¯ä»¥åŠ åœ¨è¡¨ä¸Šï¼Œä¹Ÿå¯ä»¥åŠ åœ¨è¡Œä¸Šã€‚")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711204843684.png",alt:"image-20220711204843684"}}),_._v(" "),a("h4",{attrs:{id:"_1-é”å®šè¯»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-é”å®šè¯»"}},[_._v("#")]),_._v(" 1.é”å®šè¯»")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711212931912.png",alt:"image-20220711212931912"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711213741630.png",alt:"image-20220711213741630"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711214013208.png",alt:"image-20220711214013208"}}),_._v(" "),a("h4",{attrs:{id:"_2-å†™æ“ä½œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å†™æ“ä½œ"}},[_._v("#")]),_._v(" 2. å†™æ“ä½œ")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711214412163.png",alt:"image-20220711214412163"}}),_._v(" "),a("h3",{attrs:{id:"_3-2-ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†-è¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†-è¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”"}},[_._v("#")]),_._v(" 3.2 ä»æ•°æ®æ“ä½œçš„ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ã€é¡µçº§é”ã€è¡Œé”")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711214719510.png",alt:"image-20220711214719510"}}),_._v(" "),a("h4",{attrs:{id:"_1-è¡¨é”-table-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¡¨é”-table-lock"}},[_._v("#")]),_._v(" 1. è¡¨é”ï¼ˆTable Lockï¼‰")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711214805088.png",alt:"image-20220711214805088"}}),_._v(" "),a("h5",{attrs:{id:"_1-è¡¨çº§åˆ«çš„sé”ã€xé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è¡¨çº§åˆ«çš„sé”ã€xé”"}},[_._v("#")]),_._v(" â‘  è¡¨çº§åˆ«çš„Sé”ã€Xé”")]),_._v(" "),a("p",[_._v("åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„ "),a("code",[_._v("Sé”")]),_._v(" æˆ–è€… "),a("code",[_._v("Xé”")]),_._v(" çš„ã€‚åœ¨å¯¹æŸä¸ªè¡¨æ‰§è¡Œä¸€äº›è¯¸å¦‚ "),a("code",[_._v("ALTER TABLE ã€ DROP TABLE")]),_._v(" è¿™ç±»çš„ DDL è¯­å¥æ—¶ï¼Œå…¶ ä»–äº‹åŠ¡å¯¹è¿™ä¸ªè¡¨å¹¶å‘æ‰§è¡Œè¯¸å¦‚SELECTã€INSERTã€DELETEã€UPDATEçš„è¯­å¥ä¼šå‘ç”Ÿé˜»å¡ã€‚åŒç†ï¼ŒæŸä¸ªäº‹åŠ¡ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡ŒSELECTã€INSERTã€DELETEã€UPDATEè¯­å¥æ—¶ï¼Œåœ¨å…¶ä»–ä¼šè¯ä¸­å¯¹è¿™ä¸ªè¡¨æ‰§è¡Œ "),a("code",[_._v("DDL")]),_._v(" è¯­å¥ä¹Ÿä¼š å‘ç”Ÿé˜»å¡ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®æ˜¯é€šè¿‡åœ¨ serverå±‚ä½¿ç”¨ä¸€ç§ç§°ä¹‹ä¸º "),a("code",[_._v("å…ƒæ•°æ®é”")]),_._v(" ï¼ˆè‹±æ–‡åï¼š Metadata Locks ï¼Œ ç®€ç§° MDL ï¼‰ç»“æ„æ¥å®ç°çš„ã€‚")]),_._v(" "),a("p",[_._v("ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ä¼šä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨çº§åˆ«çš„ "),a("code",[_._v("Sé”")]),_._v(" å’Œ "),a("code",[_._v("Xé”")]),_._v(" ã€‚åªä¼šåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”æ–¹è¯´ "),a("code",[_._v("å´©æºƒæ¢å¤")]),_._v(" è¿‡ç¨‹ä¸­ç”¨åˆ°ã€‚æ¯”å¦‚ï¼Œåœ¨ç³»ç»Ÿå˜é‡ "),a("code",[_._v("autocommit=0ï¼Œinnodb_table_locks = 1")]),_._v(" æ—¶ï¼Œ æ‰‹åŠ¨ è·å– InnoDBå­˜å‚¨å¼•æ“æä¾›çš„è¡¨t çš„ "),a("code",[_._v("Sé”")]),_._v(" æˆ–è€… "),a("code",[_._v("Xé”")]),_._v(" å¯ä»¥è¿™ä¹ˆå†™ï¼š")]),_._v(" "),a("ul",[a("li",[a("p",[a("code",[_._v("LOCK TABLES t READ")]),_._v(" ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ "),a("code",[_._v("Sé”")]),_._v("ã€‚")])]),_._v(" "),a("li",[a("p",[a("code",[_._v("LOCK TABLES t WRITE")]),_._v(" ï¼šInnoDBå­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨ t åŠ è¡¨çº§åˆ«çš„ "),a("code",[_._v("Xé”")]),_._v(" ã€‚")])])]),_._v(" "),a("p",[_._v("ä¸è¿‡å°½é‡é¿å…åœ¨ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“çš„è¡¨ä¸Šä½¿ç”¨ "),a("code",[_._v("LOCK TABLES")]),_._v(" è¿™æ ·çš„æ‰‹åŠ¨é”è¡¨è¯­å¥ï¼Œå®ƒä»¬å¹¶ä¸ä¼šæä¾› ä»€ä¹ˆé¢å¤–çš„ä¿æŠ¤ï¼Œåªæ˜¯ä¼šé™ä½å¹¶å‘èƒ½åŠ›è€Œå·²ã€‚InnoDBçš„å‰å®³ä¹‹å¤„è¿˜æ˜¯å®ç°äº†æ›´ç»†ç²’åº¦çš„ "),a("code",[_._v("è¡Œé”")]),_._v(" ï¼Œå…³äº InnoDBè¡¨çº§åˆ«çš„ "),a("code",[_._v("Sé”")]),_._v(" å’Œ"),a("code",[_._v("Xé”")]),_._v(" å¤§å®¶äº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚")]),_._v(" "),a("p",[_._v("**ä¸¾ä¾‹ï¼š**ä¸‹é¢æˆ‘ä»¬è®²è§£MyISAMå¼•æ“ä¸‹çš„è¡¨é”ã€‚")]),_._v(" "),a("p",[_._v("æ­¥éª¤1ï¼šåˆ›å»ºè¡¨å¹¶æ·»åŠ æ•°æ®")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("CREATE TABLE mylock(\nid INT NOT NULL PRIMARY KEY auto_increment,\nNAME VARCHAR(20)\n)ENGINE myisam;\n\n# æ’å…¥ä¸€æ¡æ•°æ®\nINSERT INTO mylock(NAME) VALUES('a');\n\n# æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰æ•°æ®\nSELECT * FROM mylock;\n+----+------+\n| id | Name |\n+----+------+\n| 1  | a    |\n+----+------+\n")])])]),a("p",[_._v("æ­¥éª¤äºŒï¼šæŸ¥çœ‹è¡¨ä¸ŠåŠ è¿‡çš„é”")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("SHOW OPEN TABLES; # ä¸»è¦å…³æ³¨In_useå­—æ®µçš„å€¼\næˆ–è€…\nSHOW OPEN TABLES where In_use > 0;\n")])])]),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220342251.png",alt:"image-20220711220342251"}}),_._v(" "),a("p",[_._v("æˆ–è€…")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220418859.png",alt:"image-20220711220418859"}}),_._v(" "),a("p",[_._v("ä¸Šé¢çš„ç»“æœè¡¨æ˜ï¼Œå½“å‰æ•°æ®åº“ä¸­æ²¡æœ‰è¢«é”å®šçš„è¡¨")]),_._v(" "),a("p",[_._v("æ­¥éª¤3ï¼šæ‰‹åŠ¨å¢åŠ è¡¨é”å‘½ä»¤")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("LOCK TABLES t READ; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„å…±äº«é”ã€‚å…±äº«é”ä¹Ÿå«è¯»é”æˆ–Sé”ï¼ˆShareçš„ç¼©å†™ï¼‰\nLOCK TABLES t WRITE; # å­˜å‚¨å¼•æ“ä¼šå¯¹è¡¨tåŠ è¡¨çº§åˆ«çš„æ’ä»–é”ã€‚æ’ä»–é”ä¹Ÿå«ç‹¬å é”ã€å†™é”æˆ–Xé”ï¼ˆexclusiveçš„ç¼©å†™ï¼‰\n")])])]),a("p",[_._v("æ¯”å¦‚ï¼š")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220442269.png",alt:"image-20220711220442269"}}),_._v(" "),a("p",[_._v("æ­¥éª¤4ï¼šé‡Šæ”¾è¡¨é”")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("UNLOCK TABLES; # ä½¿ç”¨æ­¤å‘½ä»¤è§£é”å½“å‰åŠ é”çš„è¡¨\n")])])]),a("p",[_._v("æ¯”å¦‚ï¼š")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220502141.png",alt:"image-20220711220502141"}}),_._v(" "),a("p",[_._v("æ­¥éª¤5ï¼šåŠ è¯»é”")]),_._v(" "),a("p",[_._v("æˆ‘ä»¬ä¸ºmylockè¡¨åŠ readé”ï¼ˆè¯»é˜»å¡å†™ï¼‰ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220553225.png",alt:"image-20220711220553225"}})]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220616537.png",alt:"image-20220711220616537"}})]),_._v(" "),a("p",[_._v("æ­¥éª¤6ï¼šåŠ å†™é”")]),_._v(" "),a("p",[_._v("ä¸ºmylockè¡¨åŠ writeé”ï¼Œè§‚å¯Ÿé˜»å¡çš„æƒ…å†µï¼Œæµç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220711630.png",alt:"image-20220711220711630"}})]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220730112.png",alt:"image-20220711220730112"}})]),_._v(" "),a("p",[_._v("æ€»ç»“ï¼š")]),_._v(" "),a("p",[_._v("MyISAMåœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹æ“ä½œå‰ï¼Œä¼šç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ã€‚InnoDBå­˜å‚¨å¼•æ“æ˜¯ä¸ä¼šä¸ºè¿™ä¸ªè¡¨æ·»åŠ è¡¨çº§åˆ«çš„è¯»é”å’Œå†™é”çš„ã€‚")]),_._v(" "),a("p",[_._v("MySQLçš„è¡¨çº§é”æœ‰ä¸¤ç§æ¨¡å¼ï¼šï¼ˆä»¥MyISAMè¡¨è¿›è¡Œæ“ä½œçš„æ¼”ç¤ºï¼‰")]),_._v(" "),a("ul",[a("li",[a("p",[_._v("è¡¨å…±äº«è¯»é”ï¼ˆTable Read Lockï¼‰")])]),_._v(" "),a("li",[a("p",[_._v("è¡¨ç‹¬å å†™é”ï¼ˆTable Write Lockï¼‰")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711220929248.png",alt:"image-20220711220929248"}})])])]),_._v(" "),a("h5",{attrs:{id:"_2-æ„å‘é”-intention-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ„å‘é”-intention-lock"}},[_._v("#")]),_._v(" â‘¡ æ„å‘é” ï¼ˆintention lockï¼‰")]),_._v(" "),a("p",[_._v("InnoDB æ”¯æŒ "),a("code",[_._v("å¤šç²’åº¦é”ï¼ˆmultiple granularity lockingï¼‰")]),_._v(" ï¼Œå®ƒå…è®¸ "),a("code",[_._v("è¡Œçº§é”")]),_._v(" ä¸ "),a("code",[_._v("è¡¨çº§é”")]),_._v(" å…±å­˜ï¼Œè€Œ"),a("code",[_._v("æ„å‘é”")]),_._v("å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ "),a("code",[_._v("è¡¨é”")]),_._v(" ã€‚")]),_._v(" "),a("ol",[a("li",[_._v("æ„å‘é”çš„å­˜åœ¨æ˜¯ä¸ºäº†åè°ƒè¡Œé”å’Œè¡¨é”çš„å…³ç³»ï¼Œæ”¯æŒå¤šç²’åº¦ï¼ˆè¡¨é”å’Œè¡Œé”ï¼‰çš„é”å¹¶å­˜ã€‚")]),_._v(" "),a("li",[_._v("æ„å‘é”æ˜¯ä¸€ç§"),a("code",[_._v("ä¸ä¸è¡Œçº§é”å†²çªè¡¨çº§é”")]),_._v("ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚")]),_._v(" "),a("li",[_._v("è¡¨æ˜â€œæŸä¸ªäº‹åŠ¡æ­£åœ¨æŸäº›è¡ŒæŒæœ‰äº†é”æˆ–è¯¥äº‹åŠ¡å‡†å¤‡å»æŒæœ‰é”â€")])]),_._v(" "),a("p",[_._v("æ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š")]),_._v(" "),a("ul",[a("li",[a("p",[a("strong",[_._v("æ„å‘å…±äº«é”")]),_._v("ï¼ˆintention shared lock, ISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ "),a("strong",[_._v("å…±äº«é”")]),_._v("ï¼ˆSé”ï¼‰")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ S é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IS é”ã€‚\nSELECT column FROM table ... LOCK IN SHARE MODE;\n")])])])]),_._v(" "),a("li",[a("p",[a("strong",[_._v("æ„å‘æ’ä»–é”")]),_._v("ï¼ˆintention exclusive lock, IXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ "),a("strong",[_._v("æ’ä»–é”")]),_._v("ï¼ˆXé”ï¼‰")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("-- äº‹åŠ¡è¦è·å–æŸäº›è¡Œçš„ X é”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ IX é”ã€‚\nSELECT column FROM table ... FOR UPDATE;\n")])])])])]),_._v(" "),a("p",[_._v("å³ï¼šæ„å‘é”æ˜¯ç”±å­˜å‚¨å¼•æ“ "),a("code",[_._v("è‡ªå·±ç»´æŠ¤çš„")]),_._v(" ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰ï¼Œ InooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œ "),a("code",[_._v("æ‰€åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”")]),_._v(" ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("1. æ„å‘é”è¦è§£å†³çš„é—®é¢˜")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220711222132300.png",alt:"image-20220711222132300"}}),_._v(" "),a("p",[_._v("**ä¸¾ä¾‹ï¼š**åˆ›å»ºè¡¨teacher,æ’å…¥6æ¡æ•°æ®ï¼Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«é»˜è®¤ä¸º"),a("code",[_._v("Repeatable-Read")]),_._v("ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("CREATE TABLE `teacher` (\n\t`id` int NOT NULL,\n    `name` varchar(255) NOT NULL,\n    PRIMARY KEY (`id`)\n)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\n\nINSERT INTO `teacher` VALUES\n('1', 'zhangsan'),\n('2', 'lisi'),\n('3', 'wangwu'),\n('4', 'zhaoliu'),\n('5', 'songhongkang'),\n('6', 'leifengyang');\n")])])]),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> SELECT @@transaction_isolation;\n+-------------------------+\n| @@transaction_isolation |\n+-------------------------+\n| REPEATABLE-READ         |\n+-------------------------+\n")])])]),a("p",[_._v("å‡è®¾äº‹åŠ¡Aè·å–äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼Œè¯­å¥å¦‚ä¸‹æ‰€ç¤º:")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nSELECT * FROM teacher WHERE id = 6 FOR UPDATE;\n")])])]),a("p",[_._v("äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„è¡¨è¯»é”ï¼Œè¯­å¥å¦‚ä¸‹ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nLOCK TABLES teacher READ;\n")])])]),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220712124209006.png",alt:"image-20220712124209006"}}),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nSELECT * FROM teacher WHERE id = 6 FOR UPDATE;\n")])])]),a("p",[_._v("æ­¤æ—¶teacherè¡¨å­˜åœ¨ä¸¤æŠŠé”ï¼šteacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ä¸idæœª6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚äº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨çš„å…±äº«é”ã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nLOCK TABLES teacher READ;\n")])])]),a("p",[_._v("æ­¤æ—¶äº‹åŠ¡Bæ£€æµ‹äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ï¼Œå°±å¯ä»¥å¾—çŸ¥äº‹åŠ¡Aå¿…é¡»æŒæœ‰è¯¥è¡¨ä¸­æŸäº›æ•°æ®è¡Œçš„æ’ä»–é”ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚å°±ä¼šè¢«æ’æ–¥ï¼ˆé˜»å¡ï¼‰ï¼Œè€Œæ— éœ€å»æ£€æµ‹è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®æ˜¯å¦å­˜åœ¨æ’ä»–é”ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("æ„å‘é”çš„å¹¶å‘æ€§")])]),_._v(" "),a("p",[_._v("æ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº« / æ’ä»–é”äº’æ–¥ï¼æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ„å‘é”å¹¶ä¸ä¼šå½±å“åˆ°å¤šä¸ªäº‹åŠ¡å¯¹ä¸åŒæ•°æ®è¡ŒåŠ æ’ä»–é”æ—¶çš„å¹¶å‘æ€§ã€‚ï¼ˆä¸ç„¶æˆ‘ä»¬ç›´æ¥ç”¨æ™®é€šçš„è¡¨é”å°±è¡Œäº†ï¼‰")]),_._v(" "),a("p",[_._v("æˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ä¸Šé¢ teacherè¡¨çš„ä¾‹å­æ¥æ¦‚æ‹¬ä¸€ä¸‹æ„å‘é”çš„ä½œç”¨ï¼ˆä¸€æ¡æ•°æ®ä»è¢«é”å®šåˆ°è¢«é‡Šæ”¾çš„è¿‡ç¨‹ä¸­ï¼Œå¯ èƒ½å­˜åœ¨å¤šç§ä¸åŒé”ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªç€é‡è¡¨ç°æ„å‘é”ï¼‰ã€‚")]),_._v(" "),a("p",[_._v("äº‹åŠ¡Aå…ˆè·å¾—äº†æŸä¸€è¡Œçš„æ’ä»–é”ï¼Œå¹¶æœªæäº¤ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nSELECT * FROM teacher WHERE id = 6 FOR UPDATE;\n")])])]),a("p",[_._v("äº‹åŠ¡Aè·å–äº†teacherè¡¨ä¸Šçš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Aè·å–äº†idä¸º6çš„æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚ä¹‹åäº‹åŠ¡Bæƒ³è¦è·å–teacherè¡¨ä¸Šçš„å…±äº«é”ã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nLOCK TABLES teacher READ;\n")])])]),a("p",[_._v("äº‹åŠ¡Bæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Bå¯¹teacherè¡¨çš„åŠ é”è¯·æ±‚è¢«é˜»å¡ï¼ˆæ’æ–¥ï¼‰ã€‚æœ€åäº‹åŠ¡Cä¹Ÿæƒ³è·å–teacherè¡¨ä¸­æŸä¸€è¡Œçš„æ’ä»–é”ã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("BEGIN;\n\nSELECT * FROM teacher WHERE id = 5 FOR UPDATE;\n")])])]),a("p",[_._v("äº‹åŠ¡Cç”³è¯·teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚äº‹åŠ¡Cæ£€æµ‹åˆ°äº‹åŠ¡AæŒæœ‰teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºæ„å‘é”ä¹‹é—´å¹¶ä¸äº’æ–¥ï¼Œæ‰€ä»¥äº‹åŠ¡Cè·å–åˆ°äº†teacherè¡¨çš„æ„å‘æ’ä»–é”ã€‚å› ä¸ºidä¸º5çš„æ•°æ®è¡Œä¸Šä¸å­˜åœ¨ä»»ä½•æ’ä»–é”ï¼Œæœ€ç»ˆäº‹åŠ¡CæˆåŠŸè·å–åˆ°äº†è¯¥æ•°æ®è¡Œä¸Šçš„æ’ä»–é”ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("ä»ä¸Šé¢çš„æ¡ˆä¾‹å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“è®ºï¼š")])]),_._v(" "),a("ol",[a("li",[_._v("InnoDB æ”¯æŒ "),a("code",[_._v("å¤šç²’åº¦é”")]),_._v(" ï¼Œç‰¹å®šåœºæ™¯ä¸‹ï¼Œè¡Œçº§é”å¯ä»¥ä¸è¡¨çº§é”å…±å­˜ã€‚")]),_._v(" "),a("li",[_._v("æ„å‘é”ä¹‹é—´äº’ä¸æ’æ–¥ï¼Œä½†é™¤äº† IS ä¸ S å…¼å®¹å¤–ï¼Œ "),a("code",[_._v("æ„å‘é”ä¼šä¸ å…±äº«é” / æ’ä»–é” äº’æ–¥")]),_._v(" ã€‚")]),_._v(" "),a("li",[_._v("IXï¼ŒISæ˜¯è¡¨çº§é”ï¼Œä¸ä¼šå’Œè¡Œçº§çš„Xï¼ŒSé”å‘ç”Ÿå†²çªã€‚åªä¼šå’Œè¡¨çº§çš„Xï¼ŒSå‘ç”Ÿå†²çªã€‚")]),_._v(" "),a("li",[_._v("æ„å‘é”åœ¨ä¿è¯å¹¶å‘æ€§çš„å‰æä¸‹ï¼Œå®ç°äº† "),a("code",[_._v("è¡Œé”å’Œè¡¨é”å…±å­˜")]),_._v(" ä¸” "),a("code",[_._v("æ»¡è¶³äº‹åŠ¡éš”ç¦»æ€§")]),_._v(" çš„è¦æ±‚ã€‚")])]),_._v(" "),a("h5",{attrs:{id:"_3-è‡ªå¢é”-auto-incé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-è‡ªå¢é”-auto-incé”"}},[_._v("#")]),_._v(" â‘¢ è‡ªå¢é”ï¼ˆAUTO-INCé”ï¼‰")]),_._v(" "),a("p",[_._v("åœ¨ä½¿ç”¨MySQLè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¡¨çš„æŸä¸ªåˆ—æ·»åŠ  "),a("code",[_._v("AUTO_INCREMENT")]),_._v(" å±æ€§ã€‚ä¸¾ä¾‹ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("CREATE TABLE `teacher` (\n`id` int NOT NULL AUTO_INCREMENT,\n`name` varchar(255) NOT NULL,\nPRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\n")])])]),a("p",[_._v("ç”±äºè¿™ä¸ªè¡¨çš„idå­—æ®µå£°æ˜äº†AUTO_INCREMENTï¼Œæ„å‘³ç€åœ¨ä¹¦å†™æ’å…¥è¯­å¥æ—¶ä¸éœ€è¦ä¸ºå…¶èµ‹å€¼ï¼ŒSQLè¯­å¥ä¿®æ”¹ å¦‚ä¸‹æ‰€ç¤ºã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("INSERT INTO `teacher` (name) VALUES ('zhangsan'), ('lisi');\n")])])]),a("p",[_._v("ä¸Šè¾¹çš„æ’å…¥è¯­å¥å¹¶æ²¡æœ‰ä¸ºidåˆ—æ˜¾å¼èµ‹å€¼ï¼Œæ‰€ä»¥ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®ƒèµ‹ä¸Šé€’å¢çš„å€¼ï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> select * from teacher;\n+----+----------+\n| id | name     |\n+----+----------+\n| 1  | zhangsan |\n| 2  | lisi     |\n+----+----------+\n2 rows in set (0.00 sec)\n")])])]),a("p",[_._v("ç°åœ¨æˆ‘ä»¬çœ‹åˆ°çš„ä¸Šé¢æ’å…¥æ•°æ®åªæ˜¯ä¸€ç§ç®€å•çš„æ’å…¥æ¨¡å¼ï¼Œæ‰€æœ‰æ’å…¥æ•°æ®çš„æ–¹å¼æ€»å…±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ â€œ "),a("code",[_._v("Simple inserts")]),_._v(" â€ï¼Œâ€œ "),a("code",[_._v("Bulk inserts")]),_._v(" â€å’Œâ€œ "),a("code",[_._v("Mixed-mode inserts")]),_._v("â€ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("1. â€œSimple insertsâ€ ï¼ˆç®€å•æ’å…¥ï¼‰")])]),_._v(" "),a("p",[_._v("å¯ä»¥ "),a("code",[_._v("é¢„å…ˆç¡®å®šè¦æ’å…¥çš„è¡Œæ•°")]),_._v(" ï¼ˆå½“è¯­å¥è¢«åˆå§‹å¤„ç†æ—¶ï¼‰çš„è¯­å¥ã€‚åŒ…æ‹¬æ²¡æœ‰åµŒå¥—å­æŸ¥è¯¢çš„å•è¡Œå’Œå¤šè¡Œ"),a("code",[_._v("INSERT...VALUES()")]),_._v("å’Œ "),a("code",[_._v("REPLACE")]),_._v(" è¯­å¥ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­å°±å±äºè¯¥ç±»æ’å…¥ï¼Œå·²ç»ç¡®å®šè¦æ’å…¥çš„è¡Œ æ•°ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("2. â€œBulk insertsâ€ ï¼ˆæ‰¹é‡æ’å…¥ï¼‰")])]),_._v(" "),a("p",[a("code",[_._v("äº‹å…ˆä¸çŸ¥é“è¦æ’å…¥çš„è¡Œæ•°")]),_._v(" ï¼ˆå’Œæ‰€éœ€è‡ªåŠ¨é€’å¢å€¼çš„æ•°é‡ï¼‰çš„è¯­å¥ã€‚æ¯”å¦‚ "),a("code",[_._v("INSERT ... SELECT")]),_._v(" ï¼Œ "),a("code",[_._v("REPLACE ... SELECT")]),_._v(" å’Œ "),a("code",[_._v("LOAD DATA")]),_._v(" è¯­å¥ï¼Œä½†ä¸åŒ…æ‹¬çº¯INSERTã€‚ InnoDBåœ¨æ¯å¤„ç†ä¸€è¡Œï¼Œä¸ºAUTO_INCREMENTåˆ—")]),_._v(" "),a("p",[a("strong",[_._v("3. â€œMixed-mode insertsâ€ ï¼ˆæ··åˆæ¨¡å¼æ’å…¥ï¼‰")])]),_._v(" "),a("p",[_._v("è¿™äº›æ˜¯â€œSimple insertsâ€è¯­å¥ä½†æ˜¯æŒ‡å®šéƒ¨åˆ†æ–°è¡Œçš„è‡ªåŠ¨é€’å¢å€¼ã€‚ä¾‹å¦‚ "),a("code",[_._v("INSERT INTO teacher (id,name) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');")]),_._v(" åªæ˜¯æŒ‡å®šäº†éƒ¨åˆ†idçš„å€¼ã€‚å¦ä¸€ç§ç±»å‹çš„â€œæ··åˆæ¨¡å¼æ’å…¥â€æ˜¯ "),a("code",[_._v("INSERT ... ON DUPLICATE KEY UPDATE")]),_._v(" ã€‚")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220712175552985.png",alt:"image-20220712175552985"}}),_._v(" "),a("p",[_._v("innodb_autoinc_lock_modeæœ‰ä¸‰ç§å–å€¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸ä¸åŒé”å®šæ¨¡å¼ï¼š")]),_._v(" "),a("p",[a("code",[_._v("ï¼ˆ1ï¼‰innodb_autoinc_lock_mode = 0(â€œä¼ ç»Ÿâ€é”å®šæ¨¡å¼)")])]),_._v(" "),a("p",[_._v("åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç±»å‹çš„insertè¯­å¥éƒ½ä¼šè·å¾—ä¸€ä¸ªç‰¹æ®Šçš„è¡¨çº§AUTO-INCé”ï¼Œç”¨äºæ’å…¥å…·æœ‰ AUTO_INCREMENTåˆ—çš„è¡¨ã€‚è¿™ç§æ¨¡å¼å…¶å®å°±å¦‚æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³æ¯å½“æ‰§è¡Œinsertçš„æ—¶å€™ï¼Œéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª è¡¨çº§é”(AUTO-INCé”)ï¼Œä½¿å¾—è¯­å¥ä¸­ç”Ÿæˆçš„auto_incrementä¸ºé¡ºåºï¼Œä¸”åœ¨binlogä¸­é‡æ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯ masterä¸slaveä¸­æ•°æ®çš„auto_incrementæ˜¯ç›¸åŒçš„ã€‚å› ä¸ºæ˜¯è¡¨çº§é”ï¼Œå½“åœ¨åŒä¸€æ—¶é—´å¤šä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œinsertçš„ æ—¶å€™ï¼Œå¯¹äºAUTO-INCé”çš„äº‰å¤ºä¼š "),a("code",[_._v("é™åˆ¶å¹¶å‘")]),_._v(" èƒ½åŠ›ã€‚")]),_._v(" "),a("p",[a("code",[_._v("ï¼ˆ2ï¼‰innodb_autoinc_lock_mode = 1(â€œè¿ç»­â€é”å®šæ¨¡å¼)")])]),_._v(" "),a("p",[_._v("åœ¨ MySQL 8.0 ä¹‹å‰ï¼Œè¿ç»­é”å®šæ¨¡å¼æ˜¯ "),a("code",[_._v("é»˜è®¤")]),_._v(" çš„ã€‚")]),_._v(" "),a("p",[_._v("åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œâ€œbulk insertsâ€ä»ç„¶ä½¿ç”¨AUTO-INCè¡¨çº§é”ï¼Œå¹¶ä¿æŒåˆ°è¯­å¥ç»“æŸã€‚è¿™é€‚ç”¨äºæ‰€æœ‰INSERT ... SELECTï¼ŒREPLACE ... SELECTå’ŒLOAD DATAè¯­å¥ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¯­å¥å¯ä»¥æŒæœ‰AUTO-INCé”ã€‚")]),_._v(" "),a("p",[_._v("å¯¹äºâ€œSimple insertsâ€ï¼ˆè¦æ’å…¥çš„è¡Œæ•°äº‹å…ˆå·²çŸ¥ï¼‰ï¼Œåˆ™é€šè¿‡åœ¨ "),a("code",[_._v("mutexï¼ˆè½»é‡é”ï¼‰")]),_._v(" çš„æ§åˆ¶ä¸‹è·å¾—æ‰€éœ€æ•°é‡çš„è‡ªåŠ¨é€’å¢å€¼æ¥é¿å…è¡¨çº§AUTO-INCé”ï¼Œ å®ƒåªåœ¨åˆ†é…è¿‡ç¨‹çš„æŒç»­æ—¶é—´å†…ä¿æŒï¼Œè€Œä¸æ˜¯ç›´åˆ°è¯­å¥å®Œæˆã€‚ä¸ä½¿ç”¨è¡¨çº§AUTO-INCé”ï¼Œé™¤éAUTO-INCé”ç”±å¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒã€‚å¦‚æœå¦ä¸€ä¸ªäº‹åŠ¡ä¿æŒAUTO-INCé”ï¼Œåˆ™â€œSimple insertsâ€ç­‰å¾…AUTO-INCé”ï¼Œå¦‚åŒå®ƒæ˜¯ä¸€ä¸ªâ€œbulk insertsâ€ã€‚")]),_._v(" "),a("p",[a("code",[_._v("ï¼ˆ3ï¼‰innodb_autoinc_lock_mode = 2(â€œäº¤é”™â€é”å®šæ¨¡å¼)")])]),_._v(" "),a("p",[_._v("ä» MySQL 8.0 å¼€å§‹ï¼Œäº¤é”™é”æ¨¡å¼æ˜¯ "),a("code",[_._v("é»˜è®¤")]),_._v(" è®¾ç½®ã€‚")]),_._v(" "),a("p",[_._v("åœ¨æ­¤é”å®šæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨é€’å¢å€¼ "),a("code",[_._v("ä¿è¯")]),_._v(" åœ¨æ‰€æœ‰å¹¶å‘æ‰§è¡Œçš„æ‰€æœ‰ç±»å‹çš„insertè¯­å¥ä¸­æ˜¯ "),a("code",[_._v("å”¯ä¸€")]),_._v(" ä¸” "),a("code",[_._v("å•è°ƒé€’å¢")]),_._v(" çš„ã€‚ä½†æ˜¯ï¼Œç”±äºå¤šä¸ªè¯­å¥å¯ä»¥åŒæ—¶ç”Ÿæˆæ•°å­—ï¼ˆå³ï¼Œè·¨è¯­å¥äº¤å‰ç¼–å·ï¼‰ï¼Œ"),a("strong",[_._v("ä¸ºä»»ä½•ç»™å®šè¯­å¥æ’å…¥çš„è¡Œç”Ÿæˆçš„å€¼å¯èƒ½ä¸æ˜¯è¿ç»­çš„ã€‚")])]),_._v(" "),a("p",[_._v('å¦‚æœæ‰§è¡Œçš„è¯­å¥æ˜¯â€œsimple inserts"ï¼Œå…¶ä¸­è¦æ’å…¥çš„è¡Œæ•°å·²æå‰çŸ¥é“ï¼Œé™¤äº†"Mixed-mode inserts"ä¹‹å¤–ï¼Œä¸ºå•ä¸ªè¯­å¥ç”Ÿæˆçš„æ•°å­—ä¸ä¼šæœ‰é—´éš™ã€‚ç„¶åï¼Œå½“æ‰§è¡Œ"bulk inserts"æ—¶ï¼Œåœ¨ç”±ä»»ä½•ç»™å®šè¯­å¥åˆ†é…çš„è‡ªåŠ¨é€’å¢å€¼ä¸­å¯èƒ½å­˜åœ¨é—´éš™ã€‚')]),_._v(" "),a("h5",{attrs:{id:"_4-å…ƒæ•°æ®é”-mdlé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å…ƒæ•°æ®é”-mdlé”"}},[_._v("#")]),_._v(" â‘£ å…ƒæ•°æ®é”ï¼ˆMDLé”ï¼‰")]),_._v(" "),a("p",[_._v("MySQL5.5å¼•å…¥äº†meta data lockï¼Œç®€ç§°MDLé”ï¼Œå±äºè¡¨é”èŒƒç•´ã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚æ¯” å¦‚ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ­£åœ¨éå†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œè€Œæ‰§è¡ŒæœŸé—´å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ª "),a("code",[_._v("è¡¨ç»“æ„åšå˜æ›´")]),_._v(" ï¼Œå¢åŠ äº†ä¸€ åˆ—ï¼Œé‚£ä¹ˆæŸ¥è¯¢çº¿ç¨‹æ‹¿åˆ°çš„ç»“æœè·Ÿè¡¨ç»“æ„å¯¹ä¸ä¸Šï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚")]),_._v(" "),a("p",[_._v("å› æ­¤ï¼Œ"),a("strong",[_._v("å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”")]),_._v("ã€‚")]),_._v(" "),a("p",[_._v("è¯»é”ä¹‹é—´ä¸äº’æ–¥ï¼Œå› æ­¤ä½ å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€å¼ è¡¨å¢åˆ æŸ¥æ”¹ã€‚è¯»å†™é”ä¹‹é—´ã€å†™é”ä¹‹é—´éƒ½æ˜¯äº’æ–¥çš„ï¼Œç”¨æ¥ä¿è¯å˜æ›´è¡¨ç»“æ„æ“ä½œçš„å®‰å…¨æ€§ï¼Œè§£å†³äº†DMLå’ŒDDLæ“ä½œä¹‹é—´çš„ä¸€è‡´æ€§é—®é¢˜ã€‚"),a("code",[_._v("ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨")]),_._v("ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚")]),_._v(" "),a("p",[a("strong",[_._v("ä¸¾ä¾‹ï¼šå…ƒæ•°æ®é”çš„ä½¿ç”¨åœºæ™¯æ¨¡æ‹Ÿ")])]),_._v(" "),a("p",[_._v("**ä¼šè¯Aï¼š**ä»è¡¨ä¸­æŸ¥è¯¢æ•°æ®")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> BEGIN;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> SELECT COUNT(1) FROM teacher;\n+----------+\n| COUNT(1) |\n+----------+\n| 2        |\n+----------+\n1 row int set (7.46 sec)\n")])])]),a("p",[_._v("**ä¼šè¯Bï¼š**ä¿®æ”¹è¡¨ç»“æ„ï¼Œå¢åŠ æ–°åˆ—")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> BEGIN;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> alter table teacher add age int not null;\n")])])]),a("p",[_._v("**ä¼šè¯Cï¼š**æŸ¥çœ‹å½“å‰MySQLçš„è¿›ç¨‹")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> show processlist;\n")])])]),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713142808924.png",alt:"image-20220713142808924"}})]),_._v(" "),a("p",[_._v("é€šè¿‡ä¼šè¯Cå¯ä»¥çœ‹å‡ºä¼šè¯Bè¢«é˜»å¡ï¼Œè¿™æ˜¯ç”±äºä¼šè¯Aæ‹¿åˆ°äº†teacherè¡¨çš„å…ƒæ•°æ®è¯»é”ï¼Œä¼šè¯Bæƒ³ç”³è¯·teacherè¡¨çš„å…ƒæ•°æ®å†™é”ï¼Œç”±äºè¯»å†™é”äº’æ–¥ï¼Œä¼šè¯Béœ€è¦ç­‰å¾…ä¼šè¯Aé‡Šæ”¾å…ƒæ•°æ®é”æ‰èƒ½æ‰§è¡Œã€‚")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713143156759.png",alt:"image-20220713143156759"}}),_._v(" "),a("h4",{attrs:{id:"_2-innodbä¸­çš„è¡Œé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-innodbä¸­çš„è¡Œé”"}},[_._v("#")]),_._v(" 2. InnoDBä¸­çš„è¡Œé”")]),_._v(" "),a("p",[_._v("è¡Œé”ï¼ˆRow Lockï¼‰ä¹Ÿç§°ä¸ºè®°å½•é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é”ä½æŸä¸€è¡Œï¼ˆæŸæ¡è®°å½• rowï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQLæœåŠ¡å™¨å±‚å¹¶æ²¡æœ‰å®ç°è¡Œé”æœºåˆ¶ï¼Œ"),a("strong",[_._v("è¡Œçº§é”åªåœ¨å­˜å‚¨å¼•æ“å±‚å®ç°")]),_._v("ã€‚")]),_._v(" "),a("p",[_._v("**ä¼˜ç‚¹ï¼š**é”å®šåŠ›åº¦å°ï¼Œå‘ç”Ÿ"),a("code",[_._v("é”å†²çªæ¦‚ç‡ä½")]),_._v("ï¼Œå¯ä»¥å®ç°çš„"),a("code",[_._v("å¹¶å‘åº¦é«˜")]),_._v("ã€‚")]),_._v(" "),a("p",[_._v("**ç¼ºç‚¹ï¼š**å¯¹äº"),a("code",[_._v("é”çš„å¼€é”€æ¯”è¾ƒå¤§")]),_._v("ï¼ŒåŠ é”ä¼šæ¯”è¾ƒæ…¢ï¼Œå®¹æ˜“å‡ºç°"),a("code",[_._v("æ­»é”")]),_._v("æƒ…å†µã€‚")]),_._v(" "),a("p",[_._v("InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”ã€‚")]),_._v(" "),a("p",[_._v("é¦–å…ˆæˆ‘ä»¬åˆ›å»ºè¡¨å¦‚ä¸‹ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("CREATE TABLE student (\n\tid INT,\n    name VARCHAR(20),\n    class VARCHAR(10),\n    PRIMARY KEY (id)\n) Engine=InnoDB CHARSET=utf8;\n")])])]),a("p",[_._v("å‘è¿™ä¸ªè¡¨é‡Œæ’å…¥å‡ æ¡è®°å½•ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("INSERT INTO student VALUES\n(1, 'å¼ ä¸‰', 'ä¸€ç­'),\n(3, 'æå››', 'ä¸€ç­'),\n(8, 'ç‹äº”', 'äºŒç­'),\n(15, 'èµµå…­', 'äºŒç­'),\n(20, 'é’±ä¸ƒ', 'ä¸‰ç­');\n\nmysql> SELECT * FROM student;\n")])])]),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713161549241.png",alt:"image-20220713161549241"}}),_._v(" "),a("p",[_._v("studentè¡¨ä¸­çš„èšç°‡ç´¢å¼•çš„ç®€å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713163353648.png",alt:"image-20220713163353648"}})]),_._v(" "),a("p",[_._v("è¿™é‡ŒæŠŠB+æ ‘çš„ç´¢å¼•ç»“æ„åšäº†è¶…çº§ç®€åŒ–ï¼ŒåªæŠŠç´¢å¼•ä¸­çš„è®°å½•ç»™æ‹¿äº†å‡ºæ¥ï¼Œä¸‹é¢çœ‹çœ‹éƒ½æœ‰å“ªäº›å¸¸ç”¨çš„è¡Œé”ç±»å‹ã€‚")]),_._v(" "),a("h5",{attrs:{id:"_1-è®°å½•é”-record-locks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-è®°å½•é”-record-locks"}},[_._v("#")]),_._v(" â‘  è®°å½•é”ï¼ˆRecord Locksï¼‰")]),_._v(" "),a("p",[_._v("è®°å½•é”ä¹Ÿå°±æ˜¯ä»…ä»…æŠŠä¸€æ¡è®°å½•é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š"),a("code",[_._v("LOCK_REC_NOT_GAP")]),_._v("ã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªè®°å½•é”çš„ç¤ºæ„å›¾å¦‚æœæ‰€ç¤ºã€‚ä»…ä»…æ˜¯é”ä½äº†idå€¼ä¸º8çš„è®°å½•ï¼Œå¯¹å‘¨å›´çš„æ•°æ®æ²¡æœ‰å½±å“ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713164811567.png",alt:"image-20220713164811567"}})]),_._v(" "),a("p",[_._v("ä¸¾ä¾‹å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713164948405.png",alt:"image-20220713164948405"}})]),_._v(" "),a("p",[_._v("è®°å½•é”æ˜¯æœ‰Sé”å’ŒXé”ä¹‹åˆ†çš„ï¼Œç§°ä¹‹ä¸º "),a("code",[_._v("Så‹è®°å½•é”")]),_._v(" å’Œ "),a("code",[_._v("Xå‹è®°å½•é”")]),_._v(" ã€‚")]),_._v(" "),a("ul",[a("li",[_._v("å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Så‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä½†ä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ï¼›")]),_._v(" "),a("li",[_._v("å½“ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€æ¡è®°å½•çš„Xå‹è®°å½•é”åï¼Œå…¶ä»–äº‹åŠ¡æ—¢ä¸å¯ä»¥ç»§ç»­è·å–è¯¥è®°å½•çš„Så‹è®°å½•é”ï¼Œä¹Ÿä¸å¯ä»¥ç»§ç»­è·å–Xå‹è®°å½•é”ã€‚")])]),_._v(" "),a("h5",{attrs:{id:"_2-é—´éš™é”-gap-locks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-é—´éš™é”-gap-locks"}},[_._v("#")]),_._v(" â‘¡ é—´éš™é”ï¼ˆGap Locksï¼‰")]),_._v(" "),a("p",[a("code",[_._v("MySQL")]),_._v(" åœ¨ "),a("code",[_._v("REPEATABLE READ")]),_._v(" éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜çš„ï¼Œè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œå¯ä»¥ä½¿ç”¨ "),a("code",[_._v("MVCC")]),_._v(" æ–¹ æ¡ˆè§£å†³ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ "),a("code",[_._v("åŠ é”")]),_._v("æ–¹æ¡ˆè§£å†³ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨åŠ é”æ–¹æ¡ˆè§£å†³æ—¶æœ‰ä¸ªå¤§é—®é¢˜ï¼Œå°±æ˜¯äº‹åŠ¡åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œé‚£äº›å¹»å½±è®°å½•å°šä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ— æ³•ç»™è¿™äº› "),a("code",[_._v("å¹»å½±è®°å½•")]),_._v(" åŠ ä¸Š "),a("code",[_._v("è®°å½•é”")]),_._v(" ã€‚InnoDBæå‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º "),a("code",[_._v("Gap Locks")]),_._v(" çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š"),a("code",[_._v("LOCK_GAP")]),_._v(" ï¼Œæˆ‘ä»¬å¯ä»¥ç®€ç§°ä¸º "),a("code",[_._v("gapé”")]),_._v(" ã€‚æ¯”å¦‚ï¼ŒæŠŠidå€¼ä¸º8çš„é‚£æ¡ è®°å½•åŠ ä¸€ä¸ªgapé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713171650888.png",alt:"image-20220713171650888"}})]),_._v(" "),a("p",[_._v("å›¾ä¸­idå€¼ä¸º8çš„è®°å½•åŠ äº†gapé”ï¼Œæ„å‘³ç€ "),a("code",[_._v("ä¸å…è®¸åˆ«çš„äº‹åŠ¡åœ¨idå€¼ä¸º8çš„è®°å½•å‰è¾¹çš„é—´éš™æ’å…¥æ–°è®°å½•")]),_._v(" ï¼Œå…¶å®å°±æ˜¯ idåˆ—çš„å€¼(3, 8)è¿™ä¸ªåŒºé—´çš„æ–°è®°å½•æ˜¯ä¸å…è®¸ç«‹å³æ’å…¥çš„ã€‚æ¯”å¦‚ï¼Œæœ‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡å†æƒ³æ’å…¥ä¸€æ¡idå€¼ä¸º4çš„æ–° è®°å½•ï¼Œå®ƒå®šä½åˆ°è¯¥æ¡æ–°è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•çš„idå€¼ä¸º8ï¼Œè€Œè¿™æ¡è®°å½•ä¸Šåˆæœ‰ä¸€ä¸ªgapé”ï¼Œæ‰€ä»¥å°±ä¼šé˜»å¡æ’å…¥ æ“ä½œï¼Œç›´åˆ°æ‹¥æœ‰è¿™ä¸ªgapé”çš„äº‹åŠ¡æäº¤äº†ä¹‹åï¼Œidåˆ—çš„å€¼åœ¨åŒºé—´(3, 8)ä¸­çš„æ–°è®°å½•æ‰å¯ä»¥è¢«æ’å…¥ã€‚")]),_._v(" "),a("p",[_._v("**gapé”çš„æå‡ºä»…ä»…æ˜¯ä¸ºäº†é˜²æ­¢æ’å…¥å¹»å½±è®°å½•è€Œæå‡ºçš„ã€‚**è™½ç„¶æœ‰"),a("code",[_._v("å…±äº«gapé”")]),_._v("å’Œ"),a("code",[_._v("ç‹¬å gapé”")]),_._v("è¿™æ ·çš„è¯´æ³•ï¼Œä½†æ˜¯å®ƒä»¬èµ·åˆ°çš„ä½œç”¨æ˜¯ç›¸åŒçš„ã€‚è€Œä¸”å¦‚æœå¯¹ä¸€æ¡è®°å½•åŠ äº†gapé”ï¼ˆä¸è®ºæ˜¯å…±äº«gapé”è¿˜æ˜¯ç‹¬å gapé”ï¼‰ï¼Œå¹¶ä¸ä¼šé™åˆ¶å…¶ä»–äº‹åŠ¡å¯¹è¿™æ¡è®°å½•åŠ è®°å½•é”æˆ–è€…ç»§ç»­åŠ gapé”ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("ä¸¾ä¾‹ï¼š")])]),_._v(" "),a("table",[a("thead",[a("tr",[a("th",[_._v("Session1")]),_._v(" "),a("th",[_._v("Session2")])])]),_._v(" "),a("tbody",[a("tr",[a("td",[_._v("select * from student where id=5 lock in share mode;")]),_._v(" "),a("td")]),_._v(" "),a("tr",[a("td"),_._v(" "),a("td",[_._v("select * from student where id=5 for update;")])])])]),_._v(" "),a("p",[_._v("è¿™é‡Œsession2å¹¶ä¸ä¼šè¢«å µä½ã€‚å› ä¸ºè¡¨é‡Œå¹¶æ²¡æœ‰id=5è¿™æ¡è®°å½•ï¼Œå› æ­¤session1å˜‰çš„æ˜¯é—´éš™é”(3,8)ã€‚è€Œsession2ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé—´éš™åŠ çš„é—´éš™é”ã€‚å®ƒä»¬æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå³ï¼šä¿æŠ¤è¿™ä¸ªé—´éš™é”ï¼Œä¸å…è®¸æ’å…¥å€¼ã€‚ä½†ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä¸å†²çªçš„ã€‚")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713174726264.png",alt:"image-20220713174726264"}}),_._v(" "),a("ul",[a("li",[a("code",[_._v("Infimum")]),_._v("è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å°çš„è®°å½•ã€‚")]),_._v(" "),a("li",[a("code",[_._v("Supremun")]),_._v("è®°å½•ï¼Œè¡¨ç¤ºè¯¥é¡µé¢ä¸­æœ€å¤§çš„è®°å½•ã€‚")])]),_._v(" "),a("p",[_._v("ä¸ºäº†å®ç°é˜»æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥idå€¼å†(20,æ­£æ— ç©·)è¿™ä¸ªåŒºé—´çš„æ–°çºªå½•ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç´¢å¼•ä¸­çš„æœ€åä¸€æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯idå€¼ä¸º20çš„é‚£æ¡è®°å½•æ‰€åœ¨é¡µé¢çš„Supremunè®°å½•åŠ ä¸Šä¸€ä¸ªgapé”ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713174108634.png",alt:"image-20220713174108634"}})]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> select * from student where id > 20 lock in share mode;\nEmpty set (0.01 sec)\n")])])]),a("p",[_._v("æ£€æµ‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713174551814.png",alt:"image-20220713174551814"}})]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713174602102.png",alt:"image-20220713174602102"}})]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713175032619.png",alt:"image-20220713175032619"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713192418730.png",alt:"image-20220713192418730"}}),_._v(" "),a("h5",{attrs:{id:"_3-ä¸´é”®é”-next-key-locks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¸´é”®é”-next-key-locks"}},[_._v("#")]),_._v(" â‘¢ ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰")]),_._v(" "),a("p",[_._v("æœ‰æ—¶å€™æˆ‘ä»¬æ—¢æƒ³ "),a("code",[_._v("é”ä½æŸæ¡è®°å½•")]),_._v(" ï¼Œåˆæƒ³ é˜»æ­¢ å…¶ä»–äº‹åŠ¡åœ¨è¯¥è®°å½•å‰è¾¹çš„ é—´éš™æ’å…¥æ–°è®°å½• ï¼Œæ‰€ä»¥InnoDBå°±æ å‡ºäº†ä¸€ç§ç§°ä¹‹ä¸º Next-Key Locks çš„é”ï¼Œå®˜æ–¹çš„ç±»å‹åç§°ä¸ºï¼š LOCK_ORDINARY ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€ç§°ä¸º next-keyé” ã€‚Next-Key Locksæ˜¯åœ¨å­˜å‚¨å¼•æ“ innodb ã€äº‹åŠ¡çº§åˆ«åœ¨ å¯é‡å¤è¯» çš„æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“é”ï¼Œ innodbé»˜è®¤çš„é”å°±æ˜¯Next-Key locksã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠidå€¼ä¸º8çš„é‚£æ¡è®°å½•åŠ ä¸€ä¸ªnext-keyé”çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713192549340.png",alt:"image-20220713192549340"}})]),_._v(" "),a("p",[a("code",[_._v("next-keyé”")]),_._v("çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª"),a("code",[_._v("è®°å½•é”")]),_._v("å’Œä¸€ä¸ª"),a("code",[_._v("gapé”")]),_._v("çš„åˆä½“ï¼Œå®ƒæ—¢èƒ½ä¿æŠ¤è¯¥æ¡è®°å½•ï¼Œåˆèƒ½é˜»æ­¢åˆ«çš„äº‹åŠ¡å°†æ–°è®°å½•æ’å…¥è¢«ä¿æŠ¤è®°å½•å‰è¾¹çš„"),a("code",[_._v("é—´éš™")]),_._v("ã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("begin;\nselect * from student where id <=8 and id > 3 for update;\n")])])]),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713203124889.png",alt:"image-20220713203124889"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713203532124.png",alt:"image-20220713203532124"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713203619704.png",alt:"image-20220713203619704"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713203714577.png",alt:"image-20220713203714577"}}),_._v(" "),a("h4",{attrs:{id:"_3-é¡µé”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-é¡µé”"}},[_._v("#")]),_._v(" 3. é¡µé”")]),_._v(" "),a("p",[_._v("é¡µé”å°±æ˜¯åœ¨ "),a("code",[_._v("é¡µçš„ç²’åº¦")]),_._v(" ä¸Šè¿›è¡Œé”å®šï¼Œé”å®šçš„æ•°æ®èµ„æºæ¯”è¡Œé”è¦å¤šï¼Œå› ä¸ºä¸€ä¸ªé¡µä¸­å¯ä»¥æœ‰å¤šä¸ªè¡Œè®°å½•ã€‚å½“æˆ‘ ä»¬ä½¿ç”¨é¡µé”çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ•°æ®æµªè´¹çš„ç°è±¡ï¼Œä½†è¿™æ ·çš„æµªè´¹æœ€å¤šä¹Ÿå°±æ˜¯ä¸€ä¸ªé¡µä¸Šçš„æ•°æ®è¡Œã€‚"),a("strong",[_._v("é¡µé”çš„å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ã€‚é”å®šç²’åº¦ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚")])]),_._v(" "),a("p",[_._v("æ¯ä¸ªå±‚çº§çš„é”æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºé”ä¼šå ç”¨å†…å­˜ç©ºé—´ï¼Œ "),a("code",[_._v("é”ç©ºé—´çš„å¤§å°æ˜¯æœ‰é™çš„")]),_._v(" ã€‚å½“æŸä¸ªå±‚çº§çš„é”æ•°é‡ è¶…è¿‡äº†è¿™ä¸ªå±‚çº§çš„é˜ˆå€¼æ—¶ï¼Œå°±ä¼šè¿›è¡Œ "),a("code",[_._v("é”å‡çº§")]),_._v(" ã€‚é”å‡çº§å°±æ˜¯ç”¨æ›´å¤§ç²’åº¦çš„é”æ›¿ä»£å¤šä¸ªæ›´å°ç²’åº¦çš„é”ï¼Œæ¯”å¦‚ InnoDB ä¸­è¡Œé”å‡çº§ä¸ºè¡¨é”ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å ç”¨çš„é”ç©ºé—´é™ä½äº†ï¼Œä½†åŒæ—¶æ•°æ®çš„å¹¶å‘åº¦ä¹Ÿä¸‹é™äº†ã€‚")]),_._v(" "),a("h3",{attrs:{id:"_3-3-ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†-ä¹è§‚é”ã€æ‚²è§‚é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†-ä¹è§‚é”ã€æ‚²è§‚é”"}},[_._v("#")]),_._v(" 3.3 ä»å¯¹å¾…é”çš„æ€åº¦åˆ’åˆ†:ä¹è§‚é”ã€æ‚²è§‚é”")]),_._v(" "),a("p",[_._v("ä»å¯¹å¾…é”çš„æ€åº¦æ¥çœ‹é”çš„è¯ï¼Œå¯ä»¥å°†é”åˆ†æˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼Œä»åå­—ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸¤ç§é”æ˜¯ä¸¤ç§çœ‹å¾… "),a("code",[_._v("æ•°æ®å¹¶å‘çš„æ€ç»´æ–¹å¼")]),_._v(" ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å’Œæ‚²è§‚é”å¹¶ä¸æ˜¯é”ï¼Œè€Œæ˜¯é”çš„ "),a("code",[_._v("è®¾è®¡æ€æƒ³")]),_._v(" ã€‚")]),_._v(" "),a("h4",{attrs:{id:"_1-æ‚²è§‚é”-pessimistic-locking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‚²è§‚é”-pessimistic-locking"}},[_._v("#")]),_._v(" 1. æ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰")]),_._v(" "),a("p",[_._v("æ‚²è§‚é”æ˜¯ä¸€ç§æ€æƒ³ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œå¯¹æ•°æ®è¢«å…¶ä»–äº‹åŠ¡çš„ä¿®æ”¹æŒä¿å®ˆæ€åº¦ï¼Œä¼šé€šè¿‡æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶æ¥å®ç°ï¼Œä»è€Œä¿è¯æ•°æ®æ“ä½œçš„æ’å®ƒæ€§ã€‚")]),_._v(" "),a("p",[_._v("æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼š "),a("code",[_._v("é˜»å¡")]),_._v(" ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆ"),a("strong",[_._v("å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œ ç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹")]),_._v("ï¼‰ã€‚æ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ï¼Œå½“å…¶ä»–çº¿ç¨‹æƒ³è¦è®¿é—®æ•°æ®æ—¶ï¼Œéƒ½éœ€è¦é˜»å¡æŒ‚èµ·ã€‚Javaä¸­ "),a("code",[_._v("synchronized")]),_._v(" å’Œ "),a("code",[_._v("ReentrantLock")]),_._v(" ç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("ç§’æ€æ¡ˆä¾‹1ï¼š")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713204544767.png",alt:"image-20220713204544767"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713205010502.png",alt:"image-20220713205010502"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713205135694.png",alt:"image-20220713205135694"}}),_._v(" "),a("h4",{attrs:{id:"_2-ä¹è§‚é”-optimistic-locking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ä¹è§‚é”-optimistic-locking"}},[_._v("#")]),_._v(" 2. ä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰")]),_._v(" "),a("p",[_._v("ä¹è§‚é”è®¤ä¸ºå¯¹åŒä¸€æ•°æ®çš„å¹¶å‘æ“ä½œä¸ä¼šæ€»å‘ç”Ÿï¼Œå±äºå°æ¦‚ç‡äº‹ä»¶ï¼Œä¸ç”¨æ¯æ¬¡éƒ½å¯¹æ•°æ®ä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯"),a("strong",[_._v("ä¸é‡‡ç”¨æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶ï¼Œè€Œæ˜¯é€šè¿‡ç¨‹åºæ¥å®ç°")]),_._v("ã€‚åœ¨ç¨‹åºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ "),a("code",[_._v("ç‰ˆæœ¬å·æœºåˆ¶")]),_._v(" æˆ–è€… "),a("code",[_._v("CASæœºåˆ¶")]),_._v(" å®ç°ã€‚"),a("strong",[_._v("ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œ è¿™æ ·å¯ä»¥æé«˜ååé‡")]),_._v("ã€‚åœ¨Javaä¸­"),a("code",[_._v("java.util.concurrent.atomic")]),_._v(" åŒ…ä¸‹çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼šCASå®ç°çš„ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("1. ä¹è§‚é”çš„ç‰ˆæœ¬å·æœºåˆ¶")])]),_._v(" "),a("p",[_._v("åœ¨è¡¨ä¸­è®¾è®¡ä¸€ä¸ª "),a("code",[_._v("ç‰ˆæœ¬å­—æ®µ version")]),_._v(" ï¼Œç¬¬ä¸€æ¬¡è¯»çš„æ—¶å€™ï¼Œä¼šè·å– version å­—æ®µçš„å–å€¼ã€‚ç„¶åå¯¹æ•°æ®è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œæ—¶ï¼Œä¼šæ‰§è¡Œ "),a("code",[_._v("UPDATE ... SET version=version+1 WHERE version=version")]),_._v(" ã€‚æ­¤æ—¶ å¦‚æœå·²ç»æœ‰äº‹åŠ¡å¯¹è¿™æ¡æ•°æ®è¿›è¡Œäº†æ›´æ”¹ï¼Œä¿®æ”¹å°±ä¸ä¼šæˆåŠŸã€‚")]),_._v(" "),a("p",[_._v("è¿™ç§æ–¹å¼ç±»ä¼¼æˆ‘ä»¬ç†Ÿæ‚‰çš„SVNã€CVSç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†ä»£ç è¿›è¡Œæäº¤æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥å½“å‰ç‰ˆæœ¬å·ä¸æœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´å°±å¯ä»¥ç›´æ¥æäº¤ï¼Œå¦‚æœä¸ä¸€è‡´å°±éœ€è¦æ›´æ–°æœåŠ¡å™¨ä¸Šçš„æœ€æ–°ä»£ç ï¼Œç„¶åå†è¿›è¡Œæäº¤ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("2. ä¹è§‚é”çš„æ—¶é—´æˆ³æœºåˆ¶")])]),_._v(" "),a("p",[_._v("æ—¶é—´æˆ³å’Œç‰ˆæœ¬å·æœºåˆ¶ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨æ›´æ–°æäº¤çš„æ—¶å€™ï¼Œå°†å½“å‰æ•°æ®çš„æ—¶é—´æˆ³å’Œæ›´æ–°ä¹‹å‰å–å¾—çš„æ—¶é—´æˆ³è¿›è¡Œ æ¯”è¾ƒï¼Œå¦‚æœä¸¤è€…ä¸€è‡´åˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å°±æ˜¯ç‰ˆæœ¬å†²çªã€‚")]),_._v(" "),a("p",[_._v("ä½ èƒ½çœ‹åˆ°ä¹è§‚é”å°±æ˜¯ç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•°æ®å¹¶å‘æ“ä½œçš„æƒé™ï¼ŒåŸºæœ¬æ˜¯é€šè¿‡ç»™æ•°æ®è¡Œå¢åŠ ä¸€ä¸ªæˆ³ï¼ˆç‰ˆæœ¬å·æˆ– è€…æ—¶é—´æˆ³ï¼‰ï¼Œä»è€Œè¯æ˜å½“å‰æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦æœ€æ–°ã€‚")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713210951100.png",alt:"image-20220713210951100"}}),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713211139670.png",alt:"image-20220713211139670"}}),_._v(" "),a("h4",{attrs:{id:"_3-ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯"}},[_._v("#")]),_._v(" 3. ä¸¤ç§é”çš„é€‚ç”¨åœºæ™¯")]),_._v(" "),a("p",[_._v("ä»è¿™ä¸¤ç§é”çš„è®¾è®¡æ€æƒ³ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„é€‚ç”¨åœºæ™¯ï¼š")]),_._v(" "),a("ol",[a("li",[a("code",[_._v("ä¹è§‚é”")]),_._v(" é€‚åˆ "),a("code",[_._v("è¯»æ“ä½œå¤š")]),_._v(" çš„åœºæ™¯ï¼Œç›¸å¯¹æ¥è¯´å†™çš„æ“ä½œæ¯”è¾ƒå°‘ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äº "),a("code",[_._v("ç¨‹åºå®ç°")]),_._v(" ï¼Œ "),a("code",[_._v("ä¸å­˜åœ¨æ­»é”")]),_._v(" é—®é¢˜ï¼Œä¸è¿‡é€‚ç”¨åœºæ™¯ä¹Ÿä¼šç›¸å¯¹ä¹è§‚ï¼Œå› ä¸ºå®ƒé˜»æ­¢ä¸äº†é™¤äº†ç¨‹åºä»¥å¤–çš„æ•°æ®åº“æ“ä½œã€‚")]),_._v(" "),a("li",[a("code",[_._v("æ‚²è§‚é”")]),_._v(" é€‚åˆ "),a("code",[_._v("å†™æ“ä½œå¤š")]),_._v(" çš„åœºæ™¯ï¼Œå› ä¸ºå†™çš„æ“ä½œå…·æœ‰ "),a("code",[_._v("æ’å®ƒæ€§")]),_._v(" ã€‚é‡‡ç”¨æ‚²è§‚é”çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚ é¢é˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®çš„æ“ä½œæƒé™ï¼Œé˜²æ­¢ "),a("code",[_._v("è¯» - å†™")]),_._v(" å’Œ "),a("code",[_._v("å†™ - å†™")]),_._v(" çš„å†²çªã€‚")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713211417909.png",alt:"image-20220713211417909"}}),_._v(" "),a("h3",{attrs:{id:"_3-4-æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†-æ˜¾å¼é”ã€éšå¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†-æ˜¾å¼é”ã€éšå¼é”"}},[_._v("#")]),_._v(" 3.4 æŒ‰åŠ é”çš„æ–¹å¼åˆ’åˆ†ï¼šæ˜¾å¼é”ã€éšå¼é”")]),_._v(" "),a("h4",{attrs:{id:"_1-éšå¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-éšå¼é”"}},[_._v("#")]),_._v(" 1. éšå¼é”")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713211525845.png",alt:"image-20220713211525845"}}),_._v(" "),a("ul",[a("li",[a("strong",[_._v("æƒ…æ™¯ä¸€")]),_._v("ï¼šå¯¹äºèšç°‡ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ‰ä¸€ä¸ª "),a("code",[_._v("trx_id")]),_._v(" éšè—åˆ—ï¼Œè¯¥éšè—åˆ—è®°å½•ç€æœ€åæ”¹åŠ¨è¯¥è®°å½•çš„ "),a("code",[_._v("äº‹åŠ¡ id")]),_._v(" ã€‚é‚£ä¹ˆå¦‚æœåœ¨å½“å‰äº‹åŠ¡ä¸­æ–°æ’å…¥ä¸€æ¡èšç°‡ç´¢å¼•è®°å½•åï¼Œè¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„çš„å°±æ˜¯ å½“å‰äº‹åŠ¡çš„ äº‹åŠ¡id ï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡æ­¤æ—¶æƒ³å¯¹è¯¥è®°å½•æ·»åŠ  Sé” æˆ–è€… Xé” æ—¶ï¼Œé¦–å…ˆä¼šçœ‹ä¸€ä¸‹è¯¥è®°å½•çš„ trx_id éšè—åˆ—ä»£è¡¨çš„äº‹åŠ¡æ˜¯å¦æ˜¯å½“å‰çš„æ´»è·ƒäº‹åŠ¡ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå°±å¸®åŠ©å½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ª X é” ï¼ˆä¹Ÿå°±æ˜¯ä¸ºå½“å‰äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ false ï¼‰ï¼Œç„¶åè‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€ ï¼ˆä¹Ÿå°±æ˜¯ä¸ºè‡ªå·±ä¹Ÿåˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œ is_waiting å±æ€§æ˜¯ true ï¼‰ã€‚")]),_._v(" "),a("li",[a("strong",[_._v("æƒ…æ™¯äºŒ")]),_._v("ï¼šå¯¹äºäºŒçº§ç´¢å¼•è®°å½•æ¥è¯´ï¼Œæœ¬èº«å¹¶æ²¡æœ‰ trx_id éšè—åˆ—ï¼Œä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•é¡µé¢çš„ Page Header éƒ¨åˆ†æœ‰ä¸€ä¸ª "),a("code",[_._v("PAGE_MAX_TRX_ID")]),_._v(" å±æ€§ï¼Œè¯¥å±æ€§ä»£è¡¨å¯¹è¯¥é¡µé¢åšæ”¹åŠ¨çš„æœ€å¤§çš„ "),a("code",[_._v("äº‹åŠ¡id")]),_._v(" ï¼Œå¦‚ æœ PAGE_MAX_TRX_ID å±æ€§å€¼å°äºå½“å‰æœ€å°çš„æ´»è·ƒ äº‹åŠ¡id ï¼Œé‚£ä¹ˆè¯´æ˜å¯¹è¯¥é¡µé¢åšä¿®æ”¹çš„äº‹åŠ¡éƒ½å·² ç»æäº¤äº†ï¼Œå¦åˆ™å°±éœ€è¦åœ¨é¡µé¢ä¸­å®šä½åˆ°å¯¹åº”çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œç„¶åå›è¡¨æ‰¾åˆ°å®ƒå¯¹åº”çš„èšç°‡ç´¢å¼•è®° å½•ï¼Œç„¶åå†é‡å¤ æƒ…æ™¯ä¸€ çš„åšæ³•ã€‚")])]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713214522709.png",alt:"image-20220713214522709"}}),_._v(" "),a("p",[a("strong",[_._v("session 1:")])]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v('mysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> insert INTO student VALUES(34,"å‘¨å…«","äºŒç­");\nQuery OK, 1 row affected (0.00 sec)\n')])])]),a("p",[a("strong",[_._v("session 2:")])]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\nmysql> select * from student lock in share mode; #æ‰§è¡Œå®Œï¼Œå½“å‰äº‹åŠ¡è¢«é˜»å¡\n")])])]),a("p",[_._v("æ‰§è¡Œä¸‹è¿°è¯­å¥ï¼Œè¾“å‡ºç»“æœï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> SELECT * FROM performance_schema.data_lock_waits\\G;\n*************************** 1. row ***************************\n\t\t\t\t\t\tENGINE: INNODB\n\t\tREQUESTING_ENGINE_LOCK_ID: 140562531358232:7:4:9:140562535668584\nREQUESTING_ENGINE_TRANSACTION_ID: 422037508068888\n\t\t\tREQUESTING_THREAD_ID: 64\n\t\t\tREQUESTING_EVENT_ID: 6\nREQUESTING_OBJECT_INSTANCE_BEGIN: 140562535668584\n\t\tBLOCKING_ENGINE_LOCK_ID: 140562531351768:7:4:9:140562535619104\nBLOCKING_ENGINE_TRANSACTION_ID: 15902\n\t\t\tBLOCKING_THREAD_ID: 64\n\t\t\tBLOCKING_EVENT_ID: 6\nBLOCKING_OBJECT_INSTANCE_BEGIN: 140562535619104\n1 row in set (0.00 sec)\n")])])]),a("p",[_._v("éšå¼é”çš„é€»è¾‘è¿‡ç¨‹å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[_._v("A. InnoDBçš„æ¯æ¡è®°å½•ä¸­éƒ½ä¸€ä¸ªéšå«çš„trx_idå­—æ®µï¼Œè¿™ä¸ªå­—æ®µå­˜åœ¨äºèšç°‡ç´¢å¼•çš„B+Treeä¸­ã€‚")]),_._v(" "),a("p",[_._v("B. åœ¨æ“ä½œä¸€æ¡è®°å½•å‰ï¼Œé¦–å…ˆæ ¹æ®è®°å½•ä¸­çš„trx_idæ£€æŸ¥è¯¥äº‹åŠ¡æ˜¯å¦æ˜¯æ´»åŠ¨çš„äº‹åŠ¡(æœªæäº¤æˆ–å›æ»š)ã€‚å¦‚æœæ˜¯æ´»åŠ¨çš„äº‹åŠ¡ï¼Œé¦–å…ˆå°† "),a("code",[_._v("éšå¼é”")]),_._v(" è½¬æ¢ä¸º "),a("code",[_._v("æ˜¾å¼é”")]),_._v(" (å°±æ˜¯ä¸ºè¯¥äº‹åŠ¡æ·»åŠ ä¸€ä¸ªé”)ã€‚")]),_._v(" "),a("p",[_._v("C. æ£€æŸ¥æ˜¯å¦æœ‰é”å†²çªï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ›å»ºé”ï¼Œå¹¶è®¾ç½®ä¸ºwaitingçŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰å†²çªä¸åŠ é”ï¼Œè·³åˆ°Eã€‚")]),_._v(" "),a("p",[_._v("D. ç­‰å¾…åŠ é”æˆåŠŸï¼Œè¢«å”¤é†’ï¼Œæˆ–è€…è¶…æ—¶ã€‚")]),_._v(" "),a("p",[_._v("E. å†™æ•°æ®ï¼Œå¹¶å°†è‡ªå·±çš„trx_idå†™å…¥trx_idå­—æ®µã€‚")]),_._v(" "),a("h4",{attrs:{id:"_2-æ˜¾å¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ˜¾å¼é”"}},[_._v("#")]),_._v(" 2. æ˜¾å¼é”")]),_._v(" "),a("p",[_._v("é€šè¿‡ç‰¹å®šçš„è¯­å¥è¿›è¡ŒåŠ é”ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºæ˜¾ç¤ºåŠ é”ï¼Œä¾‹å¦‚ï¼š")]),_._v(" "),a("p",[_._v("æ˜¾ç¤ºåŠ å…±äº«é”ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("select .... lock in share mode\n")])])]),a("p",[_._v("æ˜¾ç¤ºåŠ æ’å®ƒé”ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("select .... for update\n")])])]),a("h3",{attrs:{id:"_3-5-å…¶å®ƒé”ä¹‹-å…¨å±€é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-å…¶å®ƒé”ä¹‹-å…¨å±€é”"}},[_._v("#")]),_._v(" 3.5 å…¶å®ƒé”ä¹‹ï¼šå…¨å±€é”")]),_._v(" "),a("p",[_._v("å…¨å±€é”å°±æ˜¯å¯¹ "),a("code",[_._v("æ•´ä¸ªæ•°æ®åº“å®ä¾‹")]),_._v(" åŠ é”ã€‚å½“ä½ éœ€è¦è®©æ•´ä¸ªåº“å¤„äº "),a("code",[_._v("åªè¯»çŠ¶æ€")]),_._v(" çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹‹å å…¶ä»–çº¿ç¨‹çš„ä»¥ä¸‹è¯­å¥ä¼šè¢«é˜»å¡ï¼šæ•°æ®æ›´æ–°è¯­å¥ï¼ˆæ•°æ®çš„å¢åˆ æ”¹ï¼‰ã€æ•°æ®å®šä¹‰è¯­å¥ï¼ˆåŒ…æ‹¬å»ºè¡¨ã€ä¿®æ”¹è¡¨ç»“ æ„ç­‰ï¼‰å’Œæ›´æ–°ç±»äº‹åŠ¡çš„æäº¤è¯­å¥ã€‚å…¨å±€é”çš„å…¸å‹ä½¿ç”¨ "),a("code",[_._v("åœºæ™¯")]),_._v(" æ˜¯ï¼šåš "),a("code",[_._v("å…¨åº“é€»è¾‘å¤‡ä»½")]),_._v(" ã€‚")]),_._v(" "),a("p",[_._v("å…¨å±€é”çš„å‘½ä»¤ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("Flush tables with read lock\n")])])]),a("h3",{attrs:{id:"_3-6-å…¶å®ƒé”ä¹‹-æ­»é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-å…¶å®ƒé”ä¹‹-æ­»é”"}},[_._v("#")]),_._v(" 3.6 å…¶å®ƒé”ä¹‹ï¼šæ­»é”")]),_._v(" "),a("h4",{attrs:{id:"_1-æ¦‚å¿µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ¦‚å¿µ"}},[_._v("#")]),_._v(" 1. æ¦‚å¿µ")]),_._v(" "),a("p",[_._v("ä¸¤ä¸ªäº‹åŠ¡éƒ½æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾ï¼Œå¹¶ä¸”åŒæ–¹éƒ½ä¸ä¼šé‡Šæ”¾è‡ªå·±çš„é”ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("ä¸¾ä¾‹1ï¼š")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713220714098.png",alt:"image-20220713220714098"}})]),_._v(" "),a("p",[a("strong",[_._v("ä¸¾ä¾‹2ï¼š")])]),_._v(" "),a("p",[_._v("ç”¨æˆ·Aç»™ç”¨æˆ·Bè½¬è´¦100ï¼Œå†æ¬¡åŒæ—¶ï¼Œç”¨æˆ·Bä¹Ÿç»™ç”¨æˆ·Aè½¬è´¦100ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œå¯èƒ½å¯¼è‡´æ­»é”ã€‚")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713220936236.png",alt:"image-20220713220936236"}}),_._v(" "),a("h4",{attrs:{id:"_2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"}},[_._v("#")]),_._v(" 2. äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶")]),_._v(" "),a("ol",[a("li",[_._v("ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šäº‹åŠ¡")]),_._v(" "),a("li",[_._v("æ¯ä¸ªäº‹åŠ¡éƒ½å·²ç»æŒæœ‰é”å¹¶ä¸”ç”³è¯·æ–°çš„é”")]),_._v(" "),a("li",[_._v("é”èµ„æºåŒæ—¶åªèƒ½è¢«åŒä¸€ä¸ªäº‹åŠ¡æŒæœ‰æˆ–è€…ä¸å…¼å®¹")]),_._v(" "),a("li",[_._v("äº‹åŠ¡ä¹‹é—´å› ä¸ºæŒæœ‰é”å’Œç”³è¯·é”å¯¼è‡´å½¼æ­¤å¾ªç¯ç­‰å¾…")])]),_._v(" "),a("blockquote",[a("p",[_._v("æ­»é”çš„å…³é”®åœ¨äºï¼šä¸¤ä¸ªï¼ˆæˆ–ä»¥ä¸Šï¼‰çš„SessionåŠ é”çš„é¡ºåºä¸ä¸€è‡´ã€‚")])]),_._v(" "),a("h4",{attrs:{id:"_3-å¦‚ä½•å¤„ç†æ­»é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¦‚ä½•å¤„ç†æ­»é”"}},[_._v("#")]),_._v(" 3. å¦‚ä½•å¤„ç†æ­»é”")]),_._v(" "),a("p",[_._v("**æ–¹å¼1ï¼š**ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼ˆinnodb_lock_wait_timeout=50s)")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713221418100.png",alt:"image-20220713221418100"}}),_._v(" "),a("p",[_._v("**æ–¹å¼2ï¼š**ä½¿ç”¨æ­»é”æ£€æµ‹å¤„ç†æ­»é”ç¨‹åº")]),_._v(" "),a("p",[_._v("æ–¹å¼1æ£€æµ‹æ­»é”å¤ªè¿‡è¢«åŠ¨ï¼Œinnodbè¿˜æä¾›äº†"),a("code",[_._v("wait-for graphç®—æ³•")]),_._v("æ¥ä¸»åŠ¨è¿›è¡Œæ­»é”æ£€æµ‹ï¼Œæ¯å½“åŠ é”è¯·æ±‚æ— æ³•ç«‹å³æ»¡è¶³éœ€è¦å¹¶è¿›å…¥ç­‰å¾…æ—¶ï¼Œwait-for graphç®—æ³•éƒ½ä¼šè¢«è§¦å‘ã€‚")]),_._v(" "),a("p",[_._v("è¿™æ˜¯ä¸€ç§è¾ƒä¸º"),a("code",[_._v("ä¸»åŠ¨çš„æ­»é”æ£€æµ‹æœºåˆ¶")]),_._v("ï¼Œè¦æ±‚æ•°æ®åº“ä¿å­˜"),a("code",[_._v("é”çš„ä¿¡æ¯é“¾è¡¨")]),_._v("å’Œ"),a("code",[_._v("äº‹åŠ¡ç­‰å¾…é“¾è¡¨")]),_._v("ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713221758941.png",alt:"image-20220713221758941"}})]),_._v(" "),a("p",[_._v("åŸºäºè¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œå¯ä»¥ç»˜åˆ¶wait-for graphï¼ˆç­‰å¾…å›¾ï¼‰")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220713221830455.png",alt:"image-20220713221830455"}})]),_._v(" "),a("blockquote",[a("p",[_._v("æ­»é”æ£€æµ‹çš„åŸç†æ˜¯æ„å»ºä¸€ä¸ªä»¥äº‹åŠ¡ä¸ºé¡¶ç‚¹ï¼Œé”ä¸ºè¾¹çš„æœ‰å‘å›¾ï¼Œåˆ¤æ–­æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ï¼Œå­˜åœ¨æ—¢æœ‰æ­»é”ã€‚")])]),_._v(" "),a("p",[_._v("ä¸€æ—¦æ£€æµ‹åˆ°å›è·¯ã€æœ‰æ­»é”ï¼Œè¿™æ—¶å€™InnoDBå­˜å‚¨å¼•æ“ä¼šé€‰æ‹©"),a("code",[_._v("å›æ»šundoé‡æœ€å°çš„äº‹åŠ¡")]),_._v("ï¼Œè®©å…¶ä»–äº‹åŠ¡ç»§ç»­æ‰§è¡Œï¼ˆ"),a("code",[_._v("innodb_deadlock_detect=on")]),_._v("è¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ï¼‰ã€‚")]),_._v(" "),a("p",[_._v("ç¼ºç‚¹ï¼šæ¯ä¸ªæ–°çš„è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œéƒ½è¦åˆ¤æ–­æ˜¯ä¸æ˜¯ç”±äºè‡ªå·±çš„åŠ å…¥å¯¼è‡´äº†æ­»é”ï¼Œè¿™ä¸ªæ“ä½œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚å¦‚æœ100ä¸ªå¹¶å‘çº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€è¡Œï¼Œæ„å‘³ç€è¦æ£€æµ‹100*100=1ä¸‡æ¬¡ï¼Œ1ä¸‡ä¸ªçº¿ç¨‹å°±ä¼šæœ‰1åƒä¸‡æ¬¡æ£€æµ‹ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("å¦‚ä½•è§£å†³ï¼Ÿ")])]),_._v(" "),a("ul",[a("li",[_._v("æ–¹å¼1ï¼šå…³é—­æ­»é”æ£€æµ‹ï¼Œä½†æ„å‘³ç€å¯èƒ½ä¼šå‡ºç°å¤§é‡çš„è¶…æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡æœ‰æŸã€‚")]),_._v(" "),a("li",[_._v("æ–¹å¼2ï¼šæ§åˆ¶å¹¶å‘è®¿é—®çš„æ•°é‡ã€‚æ¯”å¦‚åœ¨ä¸­é—´ä»¶ä¸­å®ç°å¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿï¼Œè¿™æ ·åœ¨InnoDBå†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œã€‚")])]),_._v(" "),a("p",[a("strong",[_._v("è¿›ä¸€æ­¥çš„æ€è·¯ï¼š")])]),_._v(" "),a("p",[_._v("å¯ä»¥è€ƒè™‘é€šè¿‡å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘"),a("code",[_._v("é”å†²çª")]),_._v("ã€‚æ¯”å¦‚ï¼Œè¿é”è¶…å¸‚è´¦æˆ·æ€»é¢çš„è®°å½•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åˆ°å¤šæ¡è®°å½•ä¸Šã€‚è´¦æˆ·æ€»é¢ç­‰äºè¿™å¤šä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚")]),_._v(" "),a("h4",{attrs:{id:"_4-å¦‚ä½•é¿å…æ­»é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å¦‚ä½•é¿å…æ­»é”"}},[_._v("#")]),_._v(" 4. å¦‚ä½•é¿å…æ­»é”")]),_._v(" "),a("img",{staticStyle:{float:"left"},attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714131008260.png",alt:"image-20220714131008260"}}),_._v(" "),a("h2",{attrs:{id:"_4-é”çš„å†…éƒ¨ç»“æ„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-é”çš„å†…éƒ¨ç»“æ„"}},[_._v("#")]),_._v(" 4. é”çš„å†…éƒ¨ç»“æ„")]),_._v(" "),a("p",[_._v("æˆ‘ä»¬å‰è¾¹è¯´å¯¹ä¸€æ¡è®°å½•åŠ é”çš„æœ¬è´¨å°±æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("ä¸ä¹‹å…³è”ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡å¯¹å¤šæ¡è®°å½•åŠ é”ï¼Œå°±è¦åˆ›å»ºå¤šä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("å‘¢ï¼Ÿæ¯”å¦‚ï¼š")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("# äº‹åŠ¡T1\nSELECT * FROM user LOCK IN SHARE MODE;\n")])])]),a("p",[_._v("ç†è®ºä¸Šåˆ›å»ºå¤šä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªäº‹åŠ¡è¦è·å–10000æ¡è®°å½•çš„é”ï¼Œç”Ÿæˆ10000ä¸ªé”ç»“æ„ä¹Ÿå¤ªå´©æºƒäº†ï¼æ‰€ä»¥å†³å®šåœ¨å¯¹ä¸åŒè®°å½•åŠ é”æ—¶ï¼Œå¦‚æœç¬¦åˆä¸‹è¾¹è¿™äº›æ¡ä»¶çš„è®°å½•ä¼šæ”¾åœ¨ä¸€ä¸ª"),a("code",[_._v("é”ç»“æ„")]),_._v("ä¸­ã€‚")]),_._v(" "),a("ul",[a("li",[_._v("åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡ŒåŠ é”æ“ä½œ")]),_._v(" "),a("li",[_._v("è¢«åŠ é”çš„è®°å½•åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­")]),_._v(" "),a("li",[_._v("åŠ é”çš„ç±»å‹æ˜¯ä¸€æ ·çš„")]),_._v(" "),a("li",[_._v("ç­‰å¾…çŠ¶æ€æ˜¯ä¸€æ ·çš„")])]),_._v(" "),a("p",[a("code",[_._v("InnoDB")]),_._v(" å­˜å‚¨å¼•æ“ä¸­çš„ "),a("code",[_._v("é”ç»“æ„")]),_._v(" å¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714132306208.png",alt:"image-20220714132306208"}})]),_._v(" "),a("p",[_._v("ç»“æ„è§£æï¼š")]),_._v(" "),a("p",[a("code",[_._v("1. é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯")]),_._v("ï¼š")]),_._v(" "),a("p",[_._v("ä¸è®ºæ˜¯ "),a("code",[_._v("è¡¨é”")]),_._v(" è¿˜æ˜¯ "),a("code",[_._v("è¡Œé”")]),_._v(" ï¼Œéƒ½æ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ï¼Œå“ªä¸ªäº‹åŠ¡ç”Ÿæˆäº†è¿™ä¸ªé”ç»“æ„ ï¼Œè¿™é‡Œå°±è®°å½•è¿™ä¸ª äº‹åŠ¡çš„ä¿¡æ¯ã€‚")]),_._v(" "),a("p",[_._v("æ­¤ "),a("code",[_._v("é”æ‰€åœ¨çš„äº‹åŠ¡ä¿¡æ¯")]),_._v(" åœ¨å†…å­˜ç»“æ„ä¸­åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆå¯ä»¥æ‰¾åˆ°å†…å­˜ä¸­å…³äºè¯¥äº‹åŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ¯”æ–¹è¯´äº‹åŠ¡idç­‰ã€‚")]),_._v(" "),a("p",[a("code",[_._v("2. ç´¢å¼•ä¿¡æ¯")]),_._v(" ï¼š")]),_._v(" "),a("p",[_._v("å¯¹äº "),a("code",[_._v("è¡Œé”")]),_._v(" æ¥è¯´ï¼Œéœ€è¦è®°å½•ä¸€ä¸‹åŠ é”çš„è®°å½•æ˜¯å±äºå“ªä¸ªç´¢å¼•çš„ã€‚è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚")]),_._v(" "),a("p",[a("code",[_._v("3. è¡¨é”ï¼è¡Œé”ä¿¡æ¯")]),_._v(" ï¼š")]),_._v(" "),a("p",[a("code",[_._v("è¡¨é”ç»“æ„")]),_._v(" å’Œ "),a("code",[_._v("è¡Œé”ç»“æ„")]),_._v(" åœ¨è¿™ä¸ªä½ç½®çš„å†…å®¹æ˜¯ä¸åŒçš„ï¼š")]),_._v(" "),a("ul",[a("li",[a("p",[_._v("è¡¨é”ï¼š")]),_._v(" "),a("p",[_._v("è®°è½½ç€æ˜¯å¯¹å“ªä¸ªè¡¨åŠ çš„é”ï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ä¿¡æ¯ã€‚")])]),_._v(" "),a("li",[a("p",[_._v("è¡Œé”ï¼š")]),_._v(" "),a("p",[_._v("è®°è½½äº†ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š")]),_._v(" "),a("ul",[a("li",[a("code",[_._v("Space ID")]),_._v(" ï¼šè®°å½•æ‰€åœ¨è¡¨ç©ºé—´ã€‚")]),_._v(" "),a("li",[a("code",[_._v("Page Number")]),_._v(" ï¼šè®°å½•æ‰€åœ¨é¡µå·ã€‚")]),_._v(" "),a("li",[a("code",[_._v("n_bits")]),_._v("ï¼šå¯¹äºè¡Œé”æ¥è¯´ï¼Œä¸€æ¡è®°å½•å°±å¯¹åº”ç€ä¸€ä¸ªæ¯”ç‰¹ä½ï¼Œä¸€ä¸ªé¡µé¢ä¸­åŒ…å«å¾ˆå¤šè®°å½•ï¼Œç”¨ä¸åŒ çš„æ¯”ç‰¹ä½æ¥åŒºåˆ†åˆ°åº•æ˜¯å“ªä¸€æ¡è®°å½•åŠ äº†é”ã€‚ä¸ºæ­¤åœ¨è¡Œé”ç»“æ„çš„æœ«å°¾æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œè¿™ä¸ª"),a("code",[_._v("n_bis")]),_._v("å±æ€§ä»£è¡¨ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹ä½ã€‚")])]),_._v(" "),a("blockquote",[a("p",[_._v("n_bitsçš„å€¼ä¸€èˆ¬éƒ½æ¯”é¡µé¢ä¸­è®°å½•æ¡æ•°å¤šä¸€äº›ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¹‹ååœ¨é¡µé¢ä¸­æ’å…¥äº†æ–°è®°å½•å ä¹Ÿä¸è‡³äºé‡æ–°åˆ†é…é”ç»“æ„")])])])]),_._v(" "),a("p",[a("code",[_._v("4. type_mode")]),_._v(" ï¼š")]),_._v(" "),a("p",[_._v("è¿™æ˜¯ä¸€ä¸ª32ä½çš„æ•°ï¼Œè¢«åˆ†æˆäº† "),a("code",[_._v("lock_mode")]),_._v(" ã€ "),a("code",[_._v("lock_type")]),_._v(" å’Œ "),a("code",[_._v("rec_lock_type")]),_._v(" ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714133319666.png",alt:"image-20220714133319666"}})]),_._v(" "),a("ul",[a("li",[_._v("é”çš„æ¨¡å¼ï¼ˆ "),a("code",[_._v("lock_mode")]),_._v(" ï¼‰ï¼Œå ç”¨ä½4ä½ï¼Œå¯é€‰çš„å€¼å¦‚ä¸‹ï¼š\n"),a("ul",[a("li",[a("code",[_._v("LOCK_IS")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤ºå…±äº«æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ "),a("code",[_._v("ISé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_IX")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 1 ï¼‰ï¼šè¡¨ç¤ºç‹¬å æ„å‘é”ï¼Œä¹Ÿå°±æ˜¯ "),a("code",[_._v("IXé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_S")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 2 ï¼‰ï¼šè¡¨ç¤ºå…±äº«é”ï¼Œä¹Ÿå°±æ˜¯ "),a("code",[_._v("Sé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_X")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 3 ï¼‰ï¼šè¡¨ç¤ºç‹¬å é”ï¼Œä¹Ÿå°±æ˜¯ "),a("code",[_._v("Xé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_AUTO_INC")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 4 ï¼‰ï¼šè¡¨ç¤º "),a("code",[_._v("AUTO-INCé”")]),_._v(" ã€‚")])])])]),_._v(" "),a("p",[_._v("åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼ŒLOCK_ISï¼ŒLOCK_IXï¼ŒLOCK_AUTO_INCéƒ½ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼ŒLOCK_Så’Œ LOCK_Xæ—¢å¯ä»¥ç®—æ˜¯è¡¨çº§é”çš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡Œçº§é”çš„æ¨¡å¼ã€‚")]),_._v(" "),a("ul",[a("li",[_._v("é”çš„ç±»å‹ï¼ˆ "),a("code",[_._v("lock_type")]),_._v(" ï¼‰ï¼Œå ç”¨ç¬¬5ï½8ä½ï¼Œä¸è¿‡ç°é˜¶æ®µåªæœ‰ç¬¬5ä½å’Œç¬¬6ä½è¢«ä½¿ç”¨ï¼š\n"),a("ul",[a("li",[a("code",[_._v("LOCK_TABLE")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 16 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬5ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡¨çº§é”ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_REC")]),_._v("ï¼ˆåè¿›åˆ¶çš„ 32 ï¼‰ï¼Œä¹Ÿå°±æ˜¯å½“ç¬¬6ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºè¡Œçº§é”ã€‚")])])]),_._v(" "),a("li",[_._v("è¡Œé”çš„å…·ä½“ç±»å‹ï¼ˆ "),a("code",[_._v("rec_lock_type")]),_._v(" ï¼‰ï¼Œä½¿ç”¨å…¶ä½™çš„ä½æ¥è¡¨ç¤ºã€‚åªæœ‰åœ¨ "),a("code",[_._v("lock_type")]),_._v(" çš„å€¼ä¸º "),a("code",[_._v("LOCK_REC")]),_._v(" æ—¶ï¼Œä¹Ÿå°±æ˜¯åªæœ‰åœ¨è¯¥é”ä¸ºè¡Œçº§é”æ—¶ï¼Œæ‰ä¼šè¢«ç»†åˆ†ä¸ºæ›´å¤šçš„ç±»å‹ï¼š\n"),a("ul",[a("li",[a("code",[_._v("LOCK_ORDINARY")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 0 ï¼‰ï¼šè¡¨ç¤º "),a("code",[_._v("next-keyé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_GAP")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 512 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬10ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤º "),a("code",[_._v("gapé”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_REC_NOT_GAP")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 1024 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬11ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ­£ç» "),a("code",[_._v("è®°å½•é”")]),_._v(" ã€‚")]),_._v(" "),a("li",[a("code",[_._v("LOCK_INSERT_INTENTION")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 2048 ï¼‰ï¼šä¹Ÿå°±æ˜¯å½“ç¬¬12ä¸ªæ¯”ç‰¹ä½ç½®ä¸º1æ—¶ï¼Œè¡¨ç¤ºæ’å…¥æ„å‘é”ã€‚å…¶ä»–çš„ç±»å‹ï¼šè¿˜æœ‰ä¸€äº›ä¸å¸¸ç”¨çš„ç±»å‹æˆ‘ä»¬å°±ä¸å¤šè¯´äº†ã€‚")])])]),_._v(" "),a("li",[a("code",[_._v("is_waiting")]),_._v(" å±æ€§å‘¢ï¼ŸåŸºäºå†…å­˜ç©ºé—´çš„èŠ‚çœï¼Œæ‰€ä»¥æŠŠ "),a("code",[_._v("is_waiting")]),_._v(" å±æ€§æ”¾åˆ°äº† "),a("code",[_._v("type_mode")]),_._v(" è¿™ä¸ª32 ä½çš„æ•°å­—ä¸­ï¼š\n"),a("ul",[a("li",[a("code",[_._v("LOCK_WAIT")]),_._v(" ï¼ˆåè¿›åˆ¶çš„ 256 ï¼‰ ï¼šå½“ç¬¬9ä¸ªæ¯”ç‰¹ä½ç½®ä¸º 1 æ—¶ï¼Œè¡¨ç¤º "),a("code",[_._v("is_waiting")]),_._v(" ä¸º "),a("code",[_._v("true")]),_._v(" ï¼Œä¹Ÿ å°±æ˜¯å½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„åœ¨ç­‰å¾…çŠ¶æ€ï¼›å½“è¿™ä¸ªæ¯”ç‰¹ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤º "),a("code",[_._v("is_waiting")]),_._v(" ä¸º "),a("code",[_._v("false")]),_._v(" ï¼Œä¹Ÿå°±æ˜¯å½“å‰äº‹åŠ¡è·å–é”æˆåŠŸã€‚")])])])]),_._v(" "),a("p",[a("code",[_._v("5. å…¶ä»–ä¿¡æ¯")]),_._v(" ï¼š")]),_._v(" "),a("p",[_._v("ä¸ºäº†æ›´å¥½çš„ç®¡ç†ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å„ç§é”ç»“æ„è€Œè®¾è®¡äº†å„ç§å“ˆå¸Œè¡¨å’Œé“¾è¡¨ã€‚")]),_._v(" "),a("p",[a("code",[_._v("6. ä¸€å †æ¯”ç‰¹ä½")]),_._v(" ï¼š")]),_._v(" "),a("p",[_._v("å¦‚æœæ˜¯ "),a("code",[_._v("è¡Œé”ç»“æ„")]),_._v(" çš„è¯ï¼Œåœ¨è¯¥ç»“æ„æœ«å°¾è¿˜æ”¾ç½®äº†ä¸€å †æ¯”ç‰¹ä½ï¼Œæ¯”ç‰¹ä½çš„æ•°é‡æ˜¯ç”±ä¸Šè¾¹æåˆ°çš„ "),a("code",[_._v("n_bits")]),_._v(" å±æ€§ è¡¨ç¤ºçš„ã€‚InnoDBæ•°æ®é¡µä¸­çš„æ¯æ¡è®°å½•åœ¨ "),a("code",[_._v("è®°å½•å¤´ä¿¡æ¯")]),_._v(" ä¸­éƒ½åŒ…å«ä¸€ä¸ª "),a("code",[_._v("heap_no")]),_._v(" å±æ€§ï¼Œä¼ªè®°å½• "),a("code",[_._v("Infimum")]),_._v(" çš„ "),a("code",[_._v("heap_no")]),_._v(" å€¼ä¸º 0 ï¼Œ "),a("code",[_._v("Supremum")]),_._v(" çš„ "),a("code",[_._v("heap_no")]),_._v(" å€¼ä¸º 1 ï¼Œä¹‹åæ¯æ’å…¥ä¸€æ¡è®°å½•ï¼Œ "),a("code",[_._v("heap_no")]),_._v(" å€¼å°±å¢1ã€‚ é”ç»“ æ„ æœ€åçš„ä¸€å †æ¯”ç‰¹ä½å°±å¯¹åº”ç€ä¸€ä¸ªé¡µé¢ä¸­çš„è®°å½•ï¼Œä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ä¸€ä¸ª "),a("code",[_._v("heap_no")]),_._v(" ï¼Œå³ä¸€ä¸ªæ¯”ç‰¹ä½æ˜ å°„ åˆ°é¡µå†…çš„ä¸€æ¡è®°å½•ã€‚")]),_._v(" "),a("h2",{attrs:{id:"_5-é”ç›‘æ§"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-é”ç›‘æ§"}},[_._v("#")]),_._v(" 5. é”ç›‘æ§")]),_._v(" "),a("p",[_._v("å…³äºMySQLé”çš„ç›‘æ§ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥é€šè¿‡æ£€æŸ¥ InnoDB_row_lock ç­‰çŠ¶æ€å˜é‡æ¥åˆ†æç³»ç»Ÿä¸Šçš„è¡Œé”çš„äº‰å¤ºæƒ…å†µ")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql> show status like 'innodb_row_lock%';\n+-------------------------------+-------+\n| Variable_name                 | Value |\n+-------------------------------+-------+\n| Innodb_row_lock_current_waits | 0     |\n| Innodb_row_lock_time          | 0     |\n| Innodb_row_lock_time_avg      | 0     |\n| Innodb_row_lock_time_max      | 0     |\n| Innodb_row_lock_waits         | 0     |\n+-------------------------------+-------+\n5 rows in set (0.01 sec)\n")])])]),a("p",[_._v("å¯¹å„ä¸ªçŠ¶æ€é‡çš„è¯´æ˜å¦‚ä¸‹ï¼š")]),_._v(" "),a("ul",[a("li",[_._v("Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡ï¼›")]),_._v(" "),a("li",[a("code",[_._v("Innodb_row_lock_time")]),_._v(" ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦ï¼›ï¼ˆç­‰å¾…æ€»æ—¶é•¿ï¼‰")]),_._v(" "),a("li",[a("code",[_._v("Innodb_row_lock_time_avg")]),_._v(" ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é—´ï¼›ï¼ˆç­‰å¾…å¹³å‡æ—¶é•¿ï¼‰")]),_._v(" "),a("li",[_._v("Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€å¸¸çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´ï¼›")]),_._v(" "),a("li",[a("code",[_._v("Innodb_row_lock_waits")]),_._v(" ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°ï¼›ï¼ˆç­‰å¾…æ€»æ¬¡æ•°ï¼‰")])]),_._v(" "),a("p",[_._v("å¯¹äºè¿™5ä¸ªçŠ¶æ€å˜é‡ï¼Œæ¯”è¾ƒé‡è¦çš„3ä¸ªè§ä¸Šé¢ï¼ˆç°è‰²ï¼‰ã€‚")]),_._v(" "),a("p",[_._v("å°¤å…¶æ˜¯å½“ç­‰å¾…æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹æŒ‡å®šä¼˜åŒ–è®¡åˆ’ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("å…¶ä»–ç›‘æ§æ–¹æ³•ï¼š")])]),_._v(" "),a("p",[_._v("MySQLæŠŠäº‹åŠ¡å’Œé”çš„ä¿¡æ¯è®°å½•åœ¨äº† "),a("code",[_._v("information_schema")]),_._v(" åº“ä¸­ï¼Œæ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯ "),a("code",[_._v("INNODB_TRX")]),_._v(" ã€ "),a("code",[_._v("INNODB_LOCKS")]),_._v(" å’Œ "),a("code",[_._v("INNODB_LOCK_WAITS")]),_._v(" ã€‚")]),_._v(" "),a("p",[a("code",[_._v("MySQL5.7åŠä¹‹å‰")]),_._v(" ï¼Œå¯ä»¥é€šè¿‡information_schema.INNODB_LOCKSæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œä½†åªèƒ½çœ‹åˆ°é˜»å¡äº‹ åŠ¡çš„é”ï¼›å¦‚æœäº‹åŠ¡å¹¶æœªè¢«é˜»å¡ï¼Œåˆ™åœ¨è¯¥è¡¨ä¸­çœ‹ä¸åˆ°è¯¥äº‹åŠ¡çš„é”æƒ…å†µã€‚")]),_._v(" "),a("p",[_._v("MySQL8.0åˆ é™¤äº†information_schema.INNODB_LOCKSï¼Œæ·»åŠ äº† "),a("code",[_._v("performance_schema.data_locks")]),_._v(" ï¼Œå¯ä»¥é€šè¿‡performance_schema.data_locksæŸ¥çœ‹äº‹åŠ¡çš„é”æƒ…å†µï¼Œå’ŒMySQL5.7åŠä¹‹å‰ä¸åŒï¼Œ performance_schema.data_locksä¸ä½†å¯ä»¥çœ‹åˆ°é˜»å¡è¯¥äº‹åŠ¡çš„é”ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¯¥äº‹åŠ¡æ‰€æŒæœ‰çš„é”ã€‚")]),_._v(" "),a("p",[_._v("åŒæ—¶ï¼Œinformation_schema.INNODB_LOCK_WAITSä¹Ÿè¢« "),a("code",[_._v("performance_schema.data_lock_waits")]),_._v(" æ‰€ä»£ æ›¿ã€‚")]),_._v(" "),a("p",[_._v("æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªé”ç­‰å¾…çš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä»è¿™ä¸‰å¼ è¡¨æ”¶é›†çš„ä¿¡æ¯")]),_._v(" "),a("p",[_._v("é”ç­‰å¾…åœºæ™¯ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨è®°å½•é”ä¸­çš„æ¡ˆä¾‹ï¼Œå½“äº‹åŠ¡2è¿›è¡Œç­‰å¾…æ—¶ï¼ŒæŸ¥è¯¢æƒ…å†µå¦‚ä¸‹ï¼š")]),_._v(" "),a("p",[_._v("ï¼ˆ1ï¼‰æŸ¥è¯¢æ­£åœ¨è¢«é”é˜»å¡çš„sqlè¯­å¥ã€‚")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("SELECT * FROM information_schema.INNODB_TRX\\G;\n")])])]),a("p",[_._v("é‡è¦å±æ€§ä»£è¡¨å«ä¹‰å·²åœ¨ä¸Šè¿°ä¸­æ ‡æ³¨ã€‚")]),_._v(" "),a("p",[_._v("ï¼ˆ2ï¼‰æŸ¥è¯¢é”ç­‰å¾…æƒ…å†µ")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("SELECT * FROM data_lock_waits\\G;\n*************************** 1. row ***************************\n\t\t\t\t\t\t\tENGINE: INNODB\n\t\tREQUESTING_ENGINE_LOCK_ID: 139750145405624:7:4:7:139747028690608\nREQUESTING_ENGINE_TRANSACTION_ID: 13845 #è¢«é˜»å¡çš„äº‹åŠ¡ID\n\t\t\tREQUESTING_THREAD_ID: 72\n\t\t\tREQUESTING_EVENT_ID: 26\nREQUESTING_OBJECT_INSTANCE_BEGIN: 139747028690608\n\t\tBLOCKING_ENGINE_LOCK_ID: 139750145406432:7:4:7:139747028813248\nBLOCKING_ENGINE_TRANSACTION_ID: 13844 #æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡IDï¼Œé˜»å¡äº†13845\n\t\t\tBLOCKING_THREAD_ID: 71\n\t\t\tBLOCKING_EVENT_ID: 24\nBLOCKING_OBJECT_INSTANCE_BEGIN: 139747028813248\n1 row in set (0.00 sec)\n")])])]),a("p",[_._v("ï¼ˆ3ï¼‰æŸ¥è¯¢é”çš„æƒ…å†µ")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("mysql > SELECT * from performance_schema.data_locks\\G;\n*************************** 1. row ***************************\nENGINE: INNODB\nENGINE_LOCK_ID: 139750145405624:1068:139747028693520\nENGINE_TRANSACTION_ID: 13847\nTHREAD_ID: 72\nEVENT_ID: 31\nOBJECT_SCHEMA: atguigu\nOBJECT_NAME: user\nPARTITION_NAME: NULL\nSUBPARTITION_NAME: NULL\nINDEX_NAME: NULL\nOBJECT_INSTANCE_BEGIN: 139747028693520\nLOCK_TYPE: TABLE\nLOCK_MODE: IX\nLOCK_STATUS: GRANTED\nLOCK_DATA: NULL\n*************************** 2. row ***************************\nENGINE: INNODB\nENGINE_LOCK_ID: 139750145405624:7:4:7:139747028690608\nENGINE_TRANSACTION_ID: 13847\nTHREAD_ID: 72\nEVENT_ID: 31\nOBJECT_SCHEMA: atguigu\nOBJECT_NAME: user\nPARTITION_NAME: NULL\nSUBPARTITION_NAME: NULL\nINDEX_NAME: PRIMARY\nOBJECT_INSTANCE_BEGIN: 139747028690608\nLOCK_TYPE: RECORD\nLOCK_MODE: X,REC_NOT_GAP\nLOCK_STATUS: WAITING\nLOCK_DATA: 1\n*************************** 3. row ***************************\nENGINE: INNODB\nENGINE_LOCK_ID: 139750145406432:1068:139747028816304\nENGINE_TRANSACTION_ID: 13846\nTHREAD_ID: 71\nEVENT_ID: 28\nOBJECT_SCHEMA: atguigu\nOBJECT_NAME: user\nPARTITION_NAME: NULL\nSUBPARTITION_NAME: NULL\nINDEX_NAME: NULL\nOBJECT_INSTANCE_BEGIN: 139747028816304\nLOCK_TYPE: TABLE\nLOCK_MODE: IX\nLOCK_STATUS: GRANTED\nLOCK_DATA: NULL\n*************************** 4. row ***************************\nENGINE: INNODB\nENGINE_LOCK_ID: 139750145406432:7:4:7:139747028813248\nENGINE_TRANSACTION_ID: 13846\nTHREAD_ID: 71\nEVENT_ID: 28\nOBJECT_SCHEMA: atguigu\nOBJECT_NAME: user\nPARTITION_NAME: NULL\nSUBPARTITION_NAME: NULL\nINDEX_NAME: PRIMARY\nOBJECT_INSTANCE_BEGIN: 139747028813248\nLOCK_TYPE: RECORD\nLOCK_MODE: X,REC_NOT_GAP\nLOCK_STATUS: GRANTED\nLOCK_DATA: 1\n4 rows in set (0.00 sec)\n\nERROR:\nNo query specified\n")])])]),a("p",[_._v("ä»é”çš„æƒ…å†µå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«è·å–äº†IXé”ï¼Œæˆ‘ä»¬ä»æ„å‘é”ç« èŠ‚å¯ä»¥çŸ¥é“ï¼ŒIXé”äº’ç›¸æ—¶å…¼å®¹çš„ã€‚æ‰€ ä»¥è¿™é‡Œä¸ä¼šç­‰å¾…ï¼Œä½†æ˜¯äº‹åŠ¡1åŒæ ·æŒæœ‰Xé”ï¼Œæ­¤æ—¶äº‹åŠ¡2ä¹Ÿè¦å»åŒä¸€è¡Œè®°å½•è·å–Xé”ï¼Œä»–ä»¬ä¹‹é—´ä¸å…¼å®¹ï¼Œå¯¼ è‡´ç­‰å¾…çš„æƒ…å†µå‘ç”Ÿã€‚")]),_._v(" "),a("h2",{attrs:{id:"_6-é™„å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-é™„å½•"}},[_._v("#")]),_._v(" 6. é™„å½•")]),_._v(" "),a("p",[a("strong",[_._v("é—´éš™é”åŠ é”è§„åˆ™ï¼ˆå…±11ä¸ªæ¡ˆä¾‹ï¼‰")])]),_._v(" "),a("p",[_._v("é—´éš™é”æ˜¯åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ï¼š next-key lock å®é™…ä¸Šæ˜¯ç”±é—´éš™é”åŠ è¡Œé”å®ç°çš„ï¼Œå¦‚æœåˆ‡æ¢ åˆ°è¯»æäº¤éš”ç¦»çº§åˆ« (read-committed) çš„è¯ï¼Œå°±å¥½ç†è§£äº†ï¼Œè¿‡ç¨‹ä¸­å»æ‰é—´éš™é”çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åªå‰©ä¸‹è¡Œé” çš„éƒ¨åˆ†ã€‚è€Œåœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹é—´éš™é”å°±æ²¡æœ‰äº†ï¼Œä¸ºäº†è§£å†³å¯èƒ½å‡ºç°çš„æ•°æ®å’Œæ—¥å¿—ä¸ä¸€è‡´é—®é¢˜ï¼Œéœ€è¦æŠŠ binlog æ ¼å¼è®¾ç½®ä¸º row ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¸å¤šå…¬å¸çš„é…ç½®ä¸ºï¼šè¯»æäº¤éš”ç¦»çº§åˆ«åŠ  binlog_format=rowã€‚ä¸šåŠ¡ä¸ éœ€è¦å¯é‡å¤è¯»çš„ä¿è¯ï¼Œè¿™æ ·è€ƒè™‘åˆ°è¯»æäº¤ä¸‹æ“ä½œæ•°æ®çš„é”èŒƒå›´æ›´å°ï¼ˆæ²¡æœ‰é—´éš™é”ï¼‰ï¼Œè¿™ä¸ªé€‰æ‹©æ˜¯åˆç†çš„ã€‚")]),_._v(" "),a("p",[_._v("next-key lockçš„åŠ é”è§„åˆ™")]),_._v(" "),a("p",[_._v("æ€»ç»“çš„åŠ é”è§„åˆ™é‡Œé¢ï¼ŒåŒ…å«äº†ä¸¤ä¸ª â€œ â€œ åŸåˆ™ â€ â€ ã€ä¸¤ä¸ª â€œ â€œ ä¼˜åŒ– â€ â€ å’Œä¸€ä¸ª â€œbugâ€ ã€‚")]),_._v(" "),a("ol",[a("li",[_._v("åŸåˆ™ 1 ï¼šåŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lock ã€‚ next-key lock æ˜¯å‰å¼€åé—­åŒºé—´ã€‚")]),_._v(" "),a("li",[_._v("åŸåˆ™ 2 ï¼šæŸ¥æ‰¾è¿‡ç¨‹ä¸­è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ã€‚ä»»ä½•è¾…åŠ©ç´¢å¼•ä¸Šçš„é”ï¼Œæˆ–è€…éç´¢å¼•åˆ—ä¸Šçš„é”ï¼Œæœ€ç»ˆ éƒ½è¦å›æº¯åˆ°ä¸»é”®ä¸Šï¼Œåœ¨ä¸»é”®ä¸Šä¹Ÿè¦åŠ ä¸€æŠŠé”ã€‚")]),_._v(" "),a("li",[_._v("ä¼˜åŒ– 1 ï¼šç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢ï¼Œç»™å”¯ä¸€ç´¢å¼•åŠ é”çš„æ—¶å€™ï¼Œ next-key lock é€€åŒ–ä¸ºè¡Œé”ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ InnoDBæ‰«æçš„æ˜¯ä¸€ä¸ªä¸»é”®ã€æˆ–æ˜¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•çš„è¯ï¼Œé‚£InnoDBåªä¼šé‡‡ç”¨è¡Œé”æ–¹å¼æ¥åŠ é”")]),_._v(" "),a("li",[_._v("ä¼˜åŒ– 2 ï¼šç´¢å¼•ä¸Šï¼ˆä¸ä¸€å®šæ˜¯å”¯ä¸€ç´¢å¼•ï¼‰çš„ç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³éå†æ—¶ä¸”æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ç­‰å€¼æ¡ä»¶çš„ æ—¶å€™ï¼Œ next-keylock é€€åŒ–ä¸ºé—´éš™é”ã€‚")]),_._v(" "),a("li",[_._v("ä¸€ä¸ª bug ï¼šå”¯ä¸€ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢ã€‚")])]),_._v(" "),a("p",[_._v("æˆ‘ä»¬ä»¥è¡¨testä½œä¸ºä¾‹å­ï¼Œå»ºè¡¨è¯­å¥å’Œåˆå§‹åŒ–è¯­å¥å¦‚ä¸‹ï¼šå…¶ä¸­idä¸ºä¸»é”®ç´¢å¼•")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("CREATE TABLE `test` (\n`id` int(11) NOT NULL,\n`col1` int(11) DEFAULT NULL,\n`col2` int(11) DEFAULT NULL,\nPRIMARY KEY (`id`),\nKEY `c` (`c`)\n) ENGINE=InnoDB;\ninsert into test values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n")])])]),a("p",[a("strong",[_._v("æ¡ˆä¾‹ä¸€ï¼šå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é—´éš™é”")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134603698.png",alt:"image-20220714134603698"}})]),_._v(" "),a("p",[_._v("ç”±äºè¡¨ test ä¸­æ²¡æœ‰ id=7 çš„è®°å½•")]),_._v(" "),a("p",[_._v("æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œ session A åŠ é”èŒƒå›´å°±æ˜¯ (5,10] ï¼› åŒæ—¶æ ¹æ®ä¼˜åŒ– 2 ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰ å€¼æŸ¥è¯¢ (id=7) ï¼Œè€Œ id=10 ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ next-key lock é€€åŒ–æˆé—´éš™é”ï¼Œå› æ­¤æœ€ç»ˆåŠ é”çš„èŒƒå›´æ˜¯ (5,10)")]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹äºŒï¼šéå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢é”")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134623052-16577775838551.png",alt:"image-20220714134623052"}})]),_._v(" "),a("p",[_._v("è¿™é‡Œ session A è¦ç»™ç´¢å¼• col1 ä¸Š col1=5 çš„è¿™ä¸€è¡ŒåŠ ä¸Šè¯»é”ã€‚")]),_._v(" "),a("ol",[a("li",[_._v("æ ¹æ®åŸåˆ™ 1 ï¼ŒåŠ é”å•ä½æ˜¯ next-key lock ï¼Œå·¦å¼€å³é—­ï¼Œ5æ˜¯é—­ä¸Šçš„ï¼Œå› æ­¤ä¼šç»™ (0,5] åŠ ä¸Š next-key lock ã€‚")]),_._v(" "),a("li",[_._v("è¦æ³¨æ„ c æ˜¯æ™®é€šç´¢å¼•ï¼Œå› æ­¤ä»…è®¿é—® c=5 è¿™ä¸€æ¡è®°å½•æ˜¯ä¸èƒ½é©¬ä¸Šåœä¸‹æ¥çš„ï¼ˆå¯èƒ½æœ‰col1=5çš„å…¶ä»–è®° å½•ï¼‰ï¼Œéœ€è¦å‘å³éå†ï¼ŒæŸ¥åˆ°c=10 æ‰æ”¾å¼ƒã€‚æ ¹æ®åŸåˆ™ 2 ï¼Œè®¿é—®åˆ°çš„éƒ½è¦åŠ é”ï¼Œå› æ­¤è¦ç»™ (5,10] åŠ  next-key lock ã€‚")]),_._v(" "),a("li",[_._v("ä½†æ˜¯åŒæ—¶è¿™ä¸ªç¬¦åˆä¼˜åŒ– 2 ï¼šç­‰å€¼åˆ¤æ–­ï¼Œå‘å³éå†ï¼Œæœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³ col1=5 è¿™ä¸ªç­‰å€¼æ¡ä»¶ï¼Œå› æ­¤é€€åŒ–æˆé—´éš™é” (5,10) ã€‚")]),_._v(" "),a("li",[_._v("æ ¹æ®åŸåˆ™ 2 ï¼Œ åªæœ‰è®¿é—®åˆ°çš„å¯¹è±¡æ‰ä¼šåŠ é”ï¼Œè¿™ä¸ªæŸ¥è¯¢ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä¸»é”®ç´¢å¼•ä¸Šæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ session B çš„ update è¯­å¥å¯ä»¥æ‰§è¡Œå®Œæˆã€‚")])]),_._v(" "),a("p",[_._v("ä½† session C è¦æ’å…¥ä¸€ä¸ª (7,7,7) çš„è®°å½•ï¼Œå°±ä¼šè¢« session A çš„é—´éš™é” (5,10) é”ä½ è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ã€‚")]),_._v(" "),a("p",[_._v("æ‰§è¡Œ for update æ—¶ï¼Œç³»ç»Ÿä¼šè®¤ä¸ºä½ æ¥ä¸‹æ¥è¦æ›´æ–°æ•°æ®ï¼Œå› æ­¤ä¼šé¡ºä¾¿ç»™ä¸»é”®ç´¢å¼•ä¸Šæ»¡è¶³æ¡ä»¶çš„è¡ŒåŠ ä¸Šè¡Œé”ã€‚")]),_._v(" "),a("p",[_._v("å¦‚æœä½ è¦ç”¨ lock in share modeæ¥ç»™è¡ŒåŠ è¯»é”é¿å…æ•°æ®è¢«æ›´æ–°çš„è¯ï¼Œå°±å¿…é¡»å¾—ç»•è¿‡è¦†ç›–ç´¢å¼•çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¦†ç›–ç´¢å¼•ä¸ä¼šè®¿é—®ä¸»é”®ç´¢å¼•ï¼Œä¸ä¼šç»™ä¸»é”®ç´¢å¼•ä¸ŠåŠ é”")]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹ä¸‰ï¼šä¸»é”®ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”")])]),_._v(" "),a("p",[_._v("ä¸Šé¢ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰å€¼æŸ¥è¯¢çš„ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å…³äºèŒƒå›´æŸ¥è¯¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹é¢çš„è¯­å¥")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("select * from test where id=10 for update\nselect * from tets where id>=10 and id<11 for update;\n")])])]),a("p",[_._v("è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134742049.png",alt:"image-20220714134742049"}})]),_._v(" "),a("ol",[a("li",[_._v("å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ª id=10 çš„è¡Œï¼Œå› æ­¤æœ¬è¯¥æ˜¯ next-key lock(5,10] ã€‚ æ ¹æ®ä¼˜åŒ– 1 ï¼Œä¸»é”® id ä¸Šçš„ç­‰å€¼æ¡ä»¶ï¼Œé€€åŒ–æˆè¡Œé”ï¼ŒåªåŠ äº† id=10 è¿™ä¸€è¡Œçš„è¡Œé”ã€‚")]),_._v(" "),a("li",[_._v("å®ƒæ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œ èŒƒå›´æŸ¥æ‰¾å°±å¾€åç»§ç»­æ‰¾ï¼Œæ‰¾åˆ° id=15 è¿™ä¸€è¡Œåœä¸‹æ¥ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤éœ€è¦åŠ  next-key lock(10,15] ã€‚")])]),_._v(" "),a("p",[_._v("session A è¿™æ—¶å€™é”çš„èŒƒå›´å°±æ˜¯ä¸»é”®ç´¢å¼•ä¸Šï¼Œè¡Œé” id=10 å’Œ next-key lock(10,15] ã€‚"),a("strong",[_._v("é¦–æ¬¡ session A å®šä½æŸ¥æ‰¾ id=10 çš„è¡Œçš„æ—¶å€™ï¼Œæ˜¯å½“åšç­‰å€¼æŸ¥è¯¢æ¥åˆ¤æ–­çš„ï¼Œè€Œå‘å³æ‰«æåˆ° id=15 çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢åˆ¤æ–­ã€‚")])]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹å››ï¼šéå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é”")])]),_._v(" "),a("p",[_._v("ä¸æ¡ˆä¾‹ä¸‰ä¸åŒçš„æ˜¯ï¼Œæ¡ˆä¾‹å››ä¸­æŸ¥è¯¢è¯­å¥çš„ where éƒ¨åˆ†ç”¨çš„æ˜¯å­—æ®µ c ï¼Œå®ƒæ˜¯æ™®é€šç´¢å¼•")]),_._v(" "),a("p",[_._v("è¿™ä¸¤æ¡æŸ¥è¯­å¥è‚¯å®šæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„åŠ é”è§„åˆ™ä¸å¤ªä¸€æ ·")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134822160.png",alt:"image-20220714134822160"}})]),_._v(" "),a("p",[_._v("åœ¨ç¬¬ä¸€æ¬¡ç”¨ col1=10 å®šä½è®°å½•çš„æ—¶å€™ï¼Œç´¢å¼• c ä¸ŠåŠ äº† (5,10] è¿™ä¸ª next-key lock åï¼Œç”±äºç´¢å¼• col1 æ˜¯éå”¯ ä¸€ç´¢å¼•ï¼Œæ²¡æœ‰ä¼˜åŒ–è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šèœ•å˜ä¸ºè¡Œé”ï¼Œå› æ­¤æœ€ç»ˆ sesion A åŠ çš„é”æ˜¯ï¼Œç´¢å¼• c ä¸Šçš„ (5,10] å’Œ (10,15] è¿™ä¸¤ä¸ª next-keylock ã€‚")]),_._v(" "),a("p",[_._v("è¿™é‡Œéœ€è¦æ‰«æåˆ° col1=15 æ‰åœæ­¢æ‰«æï¼Œæ˜¯åˆç†çš„ï¼Œå› ä¸º InnoDB è¦æ‰«åˆ° col1=15 ï¼Œæ‰çŸ¥é“ä¸éœ€è¦ç»§ç»­å¾€åæ‰¾äº†ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹äº”ï¼šå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢é” bug")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134846740.png",alt:"image-20220714134846740"}})]),_._v(" "),a("p",[_._v("session A æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼ŒæŒ‰ç…§åŸåˆ™ 1 çš„è¯ï¼Œåº”è¯¥æ˜¯ç´¢å¼• id ä¸ŠåªåŠ  (10,15] è¿™ä¸ª next-key lock ï¼Œå¹¶ä¸”å›  ä¸º id æ˜¯å”¯ä¸€é”®ï¼Œæ‰€ä»¥å¾ªç¯åˆ¤æ–­åˆ° id=15 è¿™ä¸€è¡Œå°±åº”è¯¥åœæ­¢äº†ã€‚")]),_._v(" "),a("p",[_._v("ä½†æ˜¯å®ç°ä¸Šï¼Œ InnoDB ä¼šå¾€å‰æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„è¡Œä¸ºæ­¢ï¼Œä¹Ÿå°±æ˜¯ id=20 ã€‚è€Œä¸”ç”±äºè¿™æ˜¯ä¸ªèŒƒå›´æ‰«æï¼Œå› æ­¤ç´¢å¼• id ä¸Šçš„ (15,20] è¿™ä¸ª next-key lock ä¹Ÿä¼šè¢«é”ä¸Šã€‚ç…§ç†è¯´ï¼Œè¿™é‡Œé”ä½ id=20 è¿™ä¸€è¡Œçš„è¡Œä¸ºï¼Œå…¶å®æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å› ä¸ºæ‰«æåˆ° id=15 ï¼Œå°±å¯ä»¥ç¡®å®šä¸ç”¨å¾€åå†æ‰¾äº†ã€‚")]),_._v(" "),a("p",[a("strong",[_._v('æ¡ˆä¾‹å…­ï¼šéå”¯ä¸€ç´¢å¼•ä¸Šå­˜åœ¨ " " ç­‰å€¼ " " çš„ä¾‹å­')])]),_._v(" "),a("p",[_._v("è¿™é‡Œï¼Œæˆ‘ç»™è¡¨ t æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼šinsert into t values(30,10,30);ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨è¡¨é‡Œé¢æœ‰ä¸¤ä¸ªc=10çš„è¡Œ")]),_._v(" "),a("p",[a("strong",[_._v("ä½†æ˜¯å®ƒä»¬çš„ä¸»é”®å€¼ id æ˜¯ä¸åŒçš„ï¼ˆåˆ†åˆ«æ˜¯ 10 å’Œ 30 ï¼‰ï¼Œå› æ­¤è¿™ä¸¤ä¸ªc=10 çš„è®°å½•ä¹‹é—´ï¼Œä¹Ÿæ˜¯æœ‰é—´éš™çš„ã€‚")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134923414.png",alt:"image-20220714134923414"}})]),_._v(" "),a("p",[_._v("è¿™æ¬¡æˆ‘ä»¬ç”¨ delete è¯­å¥æ¥éªŒè¯ã€‚æ³¨æ„ï¼Œ delete è¯­å¥åŠ é”çš„é€»è¾‘ï¼Œå…¶å®è·Ÿ select ... for update æ˜¯ç±»ä¼¼çš„ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘åœ¨æ–‡ç« å¼€å§‹æ€»ç»“çš„ä¸¤ä¸ª â€œ åŸåˆ™ â€ ã€ä¸¤ä¸ª â€œ ä¼˜åŒ– â€ å’Œä¸€ä¸ª â€œbugâ€ ã€‚")]),_._v(" "),a("p",[_._v("è¿™æ—¶ï¼Œ session A åœ¨éå†çš„æ—¶å€™ï¼Œå…ˆè®¿é—®ç¬¬ä¸€ä¸ª col1=10 çš„è®°å½•ã€‚åŒæ ·åœ°ï¼Œæ ¹æ®åŸåˆ™ 1 ï¼Œè¿™é‡ŒåŠ çš„æ˜¯ (col1=5,id=5) åˆ° (col1=10,id=10) è¿™ä¸ª next-key lock ã€‚")]),_._v(" "),a("p",[_._v("ç”±äºcæ˜¯æ™®é€šç´¢å¼•ï¼Œæ‰€ä»¥ç»§ç»­å‘å³æŸ¥æ‰¾ï¼Œç›´åˆ°ç¢°åˆ° (col1=15,id=15) è¿™ä¸€è¡Œå¾ªç¯æ‰ç»“æŸã€‚æ ¹æ®ä¼˜åŒ– 2 ï¼Œè¿™æ˜¯ ä¸€ä¸ªç­‰å€¼æŸ¥è¯¢ï¼Œå‘å³æŸ¥æ‰¾åˆ°äº†ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆ (col1=10,id=10) åˆ° (col1=15,id=15) çš„é—´éš™é”ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714134945012.png",alt:"image-20220714134945012"}})]),_._v(" "),a("p",[_._v("è¿™ä¸ª delete è¯­å¥åœ¨ç´¢å¼• c ä¸Šçš„åŠ é”èŒƒå›´ï¼Œå°±æ˜¯ä¸Šé¢å›¾ä¸­è“è‰²åŒºåŸŸè¦†ç›–çš„éƒ¨åˆ†ã€‚è¿™ä¸ªè“è‰²åŒºåŸŸå·¦å³ä¸¤è¾¹éƒ½ æ˜¯è™šçº¿ï¼Œè¡¨ç¤ºå¼€åŒºé—´ï¼Œå³ (col1=5,id=5) å’Œ (col1=15,id=15) è¿™ä¸¤è¡Œä¸Šéƒ½æ²¡æœ‰é”")]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹ä¸ƒï¼š limit è¯­å¥åŠ é”")])]),_._v(" "),a("p",[_._v("ä¾‹å­ 6 ä¹Ÿæœ‰ä¸€ä¸ªå¯¹ç…§æ¡ˆä¾‹ï¼Œåœºæ™¯å¦‚ä¸‹æ‰€ç¤ºï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135007118.png",alt:"image-20220714135007118"}})]),_._v(" "),a("p",[_._v("session A çš„ delete è¯­å¥åŠ äº† limit 2 ã€‚ä½ çŸ¥é“è¡¨ t é‡Œ c=10 çš„è®°å½•å…¶å®åªæœ‰ä¸¤æ¡ï¼Œå› æ­¤åŠ ä¸åŠ  limit 2 ï¼Œåˆ é™¤çš„æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯åŠ é”æ•ˆæœå´ä¸ä¸€æ ·")]),_._v(" "),a("p",[_._v("è¿™æ˜¯å› ä¸ºï¼Œæ¡ˆä¾‹ä¸ƒé‡Œçš„ delete è¯­å¥æ˜ç¡®åŠ äº† limit 2 çš„é™åˆ¶ï¼Œå› æ­¤åœ¨éå†åˆ° (col1=10, id=30) è¿™ä¸€è¡Œä¹‹åï¼Œ æ»¡è¶³æ¡ä»¶çš„è¯­å¥å·²ç»æœ‰ä¸¤æ¡ï¼Œå¾ªç¯å°±ç»“æŸäº†ã€‚å› æ­¤ï¼Œç´¢å¼• col1 ä¸Šçš„åŠ é”èŒƒå›´å°±å˜æˆäº†ä»ï¼ˆ col1=5,id=5) åˆ°ï¼ˆ col1=10,id=30) è¿™ä¸ªå‰å¼€åé—­åŒºé—´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135025045-16577778257713.png",alt:"image-20220714135025045"}})]),_._v(" "),a("p",[_._v("è¿™ä¸ªä¾‹å­å¯¹æˆ‘ä»¬å®è·µçš„æŒ‡å¯¼æ„ä¹‰å°±æ˜¯ï¼Œ åœ¨åˆ é™¤æ•°æ®çš„æ—¶å€™å°½é‡åŠ  limit ã€‚")]),_._v(" "),a("p",[_._v("è¿™æ ·ä¸ä»…å¯ä»¥æ§åˆ¶åˆ é™¤æ•°æ®çš„æ¡æ•°ï¼Œè®©æ“ä½œæ›´å®‰å…¨ï¼Œè¿˜å¯ä»¥å‡å°åŠ é”çš„èŒƒå›´ã€‚")]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹å…«ï¼šä¸€ä¸ªæ­»é”çš„ä¾‹å­")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135047760.png",alt:"image-20220714135047760"}})]),_._v(" "),a("ol",[a("li",[_._v("session A å¯åŠ¨äº‹åŠ¡åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥åŠ  lock in share mode ï¼Œåœ¨ç´¢å¼• col1 ä¸ŠåŠ äº† next-keylock(5,10] å’Œ é—´éš™é” (10,15) ï¼ˆç´¢å¼•å‘å³éå†é€€åŒ–ä¸ºé—´éš™é”ï¼‰ï¼›")]),_._v(" "),a("li",[_._v("session B çš„ update è¯­å¥ä¹Ÿè¦åœ¨ç´¢å¼• c ä¸ŠåŠ  next-key lock(5,10] ï¼Œè¿›å…¥é”ç­‰å¾…ï¼› å®é™…ä¸Šåˆ†æˆäº†ä¸¤æ­¥ï¼Œ å…ˆæ˜¯åŠ  (5,10) çš„é—´éš™é”ï¼ŒåŠ é”æˆåŠŸï¼›ç„¶ååŠ  col1=10 çš„è¡Œé”ï¼Œå› ä¸ºsessionAä¸Šå·²ç»ç»™è¿™è¡ŒåŠ ä¸Šäº†è¯» é”ï¼Œæ­¤æ—¶ç”³è¯·æ­»é”æ—¶ä¼šè¢«é˜»å¡")]),_._v(" "),a("li",[_._v("ç„¶å session A è¦å†æ’å…¥ (8,8,8) è¿™ä¸€è¡Œï¼Œè¢« session B çš„é—´éš™é”é”ä½ã€‚ç”±äºå‡ºç°äº†æ­»é”ï¼Œ InnoDB è®© session B å›æ»š")])]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹ä¹ï¼šorder byç´¢å¼•æ’åºçš„é—´éš™é”1")])]),_._v(" "),a("p",[_._v("å¦‚ä¸‹é¢ä¸€æ¡è¯­å¥")]),_._v(" "),a("div",{staticClass:"language-mysql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[_._v("begin;\nselect * from test where id>9 and id<12 order by id desc for update;\n")])])]),a("p",[_._v("ä¸‹å›¾ä¸ºè¿™ä¸ªè¡¨çš„ç´¢å¼•idçš„ç¤ºæ„å›¾ã€‚")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135130668.png",alt:"image-20220714135130668"}})]),_._v(" "),a("ol",[a("li",[_._v("é¦–å…ˆè¿™ä¸ªæŸ¥è¯¢è¯­å¥çš„è¯­ä¹‰æ˜¯ order by id desc ï¼Œè¦æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œä¼˜åŒ–å™¨å¿…é¡»å…ˆæ‰¾åˆ° â€œ ç¬¬ ä¸€ä¸ª id<12 çš„å€¼ â€ ã€‚")]),_._v(" "),a("li",[_._v("è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ç´¢å¼•æ ‘çš„æœç´¢è¿‡ç¨‹å¾—åˆ°çš„ï¼Œåœ¨å¼•æ“å†…éƒ¨ï¼Œå…¶å®æ˜¯è¦æ‰¾åˆ° id=12 çš„è¿™ä¸ªå€¼ï¼Œåªæ˜¯æœ€ç»ˆ æ²¡æ‰¾åˆ°ï¼Œä½†æ‰¾åˆ°äº† (10,15) è¿™ä¸ªé—´éš™ã€‚ï¼ˆ id=15 ä¸æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ next-key lock é€€åŒ–ä¸ºäº†é—´éš™é” (10, 15) ã€‚ï¼‰")]),_._v(" "),a("li",[_._v("ç„¶åå‘å·¦éå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œå°±ä¸æ˜¯ç­‰å€¼æŸ¥è¯¢äº†ï¼Œä¼šæ‰«æåˆ° id=5 è¿™ä¸€è¡Œï¼Œåˆå› ä¸ºåŒºé—´æ˜¯å·¦å¼€å³ é—­çš„ï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªnext-key lock (0,5] ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡æ ‘æœç´¢çš„æ–¹å¼å®šä½è®°å½• çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ â€œ ç­‰å€¼æŸ¥è¯¢ â€ çš„æ–¹æ³•ã€‚")])]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹åï¼šorder byç´¢å¼•æ’åºçš„é—´éš™é”2")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135206504.png",alt:"image-20220714135206504"}})]),_._v(" "),a("ol",[a("li",[a("p",[_._v("ç”±äºæ˜¯ order by col1 desc ï¼Œç¬¬ä¸€ä¸ªè¦å®šä½çš„æ˜¯ç´¢å¼• col1 ä¸Š â€œ æœ€å³è¾¹çš„ â€col1=20 çš„è¡Œã€‚è¿™æ˜¯ä¸€ä¸ªéå”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢ï¼š")]),_._v(" "),a("p",[_._v("å·¦å¼€å³é—­åŒºé—´ï¼Œé¦–å…ˆåŠ ä¸Š next-key lock (15,20] ã€‚ å‘å³éå†ï¼Œcol1=25ä¸æ»¡è¶³æ¡ä»¶ï¼Œé€€åŒ–ä¸ºé—´éš™é” æ‰€ä»¥ä¼š åŠ ä¸Šé—´éš™é”(20,25) å’Œ next-key lock (15,20] ã€‚")])]),_._v(" "),a("li",[a("p",[_._v("åœ¨ç´¢å¼• col1 ä¸Šå‘å·¦éå†ï¼Œè¦æ‰«æåˆ° col1=10 æ‰åœä¸‹æ¥ã€‚åŒæ—¶åˆå› ä¸ºå·¦å¼€å³é—­åŒºé—´ï¼Œæ‰€ä»¥ next-key lock ä¼šåŠ åˆ° (5,10] ï¼Œè¿™æ­£æ˜¯é˜»å¡session B çš„ insert è¯­å¥çš„åŸå› ã€‚")])]),_._v(" "),a("li",[a("p",[_._v("åœ¨æ‰«æè¿‡ç¨‹ä¸­ï¼Œ col1=20 ã€ col1=15 ã€ col1=10 è¿™ä¸‰è¡Œéƒ½å­˜åœ¨å€¼ï¼Œç”±äºæ˜¯ select * ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸»é”® id ä¸ŠåŠ ä¸‰ä¸ªè¡Œé”ã€‚ å› æ­¤ï¼Œ session A çš„ select è¯­å¥é”çš„èŒƒå›´å°±æ˜¯ï¼š")]),_._v(" "),a("ol",[a("li",[_._v("ç´¢å¼• col1 ä¸Š (5, 25) ï¼›")]),_._v(" "),a("li",[_._v("ä¸»é”®ç´¢å¼•ä¸Š id=15 ã€ 20 ä¸¤ä¸ªè¡Œé”ã€‚")])])])]),_._v(" "),a("p",[a("strong",[_._v("æ¡ˆä¾‹åä¸€ï¼šupdateä¿®æ”¹æ•°æ®çš„ä¾‹å­-å…ˆæ’å…¥ååˆ é™¤")])]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135300189.png",alt:"image-20220714135300189"}})]),_._v(" "),a("p",[_._v("æ³¨æ„ï¼šæ ¹æ® col1>5 æŸ¥åˆ°çš„ç¬¬ä¸€ä¸ªè®°å½•æ˜¯ col1=10 ï¼Œå› æ­¤ä¸ä¼šåŠ  (0,5] è¿™ä¸ª next-key lock ã€‚")]),_._v(" "),a("p",[_._v("session A çš„åŠ é”èŒƒå›´æ˜¯ç´¢å¼• col1 ä¸Šçš„ (5,10] ã€ (10,15] ã€ (15,20] ã€ (20,25] å’Œ(25,supremum] ã€‚")]),_._v(" "),a("p",[_._v("ä¹‹å session B çš„ç¬¬ä¸€ä¸ª update è¯­å¥ï¼Œè¦æŠŠ col1=5 æ”¹æˆ col1=1 ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼š")]),_._v(" "),a("ol",[a("li",[_._v("æ’å…¥ (col1=1, id=5) è¿™ä¸ªè®°å½•ï¼›")]),_._v(" "),a("li",[_._v("åˆ é™¤ (col1=5, id=5) è¿™ä¸ªè®°å½•ã€‚")])]),_._v(" "),a("p",[_._v("é€šè¿‡è¿™ä¸ªæ“ä½œï¼Œ session A çš„åŠ é”èŒƒå›´å˜æˆäº†å›¾ 7 æ‰€ç¤ºçš„æ ·å­:")]),_._v(" "),a("p",[a("img",{attrs:{src:"https://gaoziman.oss-cn-hangzhou.aliyuncs.com/img/image-20220714135333089.png",alt:"image-20220714135333089"}})]),_._v(" "),a("p",[_._v("å¥½ï¼Œæ¥ä¸‹æ¥ session B è¦æ‰§è¡Œ update t set col1 = 5 where col1 = 1 è¿™ä¸ªè¯­å¥äº†ï¼Œä¸€æ ·åœ°å¯ä»¥æ‹†æˆä¸¤æ­¥ï¼š")]),_._v(" "),a("ol",[a("li",[_._v("æ’å…¥ (col1=5, id=5) è¿™ä¸ªè®°å½•ï¼›")]),_._v(" "),a("li",[_._v("åˆ é™¤ (col1=1, id=5) è¿™ä¸ªè®°å½•ã€‚ ç¬¬ä¸€æ­¥è¯•å›¾åœ¨å·²ç»åŠ äº†é—´éš™é”çš„ (1,10) ä¸­æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±è¢«å µä½äº†ã€‚")])])])}),[],!1,null,null,null);a.default=e.exports}}]);